{% load static %}
<!doctype html>
<html lang="en">
  <!-- [Head] start -->

  <head>
    <title>Workflow | Upstream</title>
    <!-- [Meta] -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- Include the PDF.js library from a CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip-utils/0.1.0/jszip-utils.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>


    <!-- [Favicon] icon -->
    <link rel="icon" href="{% static 'images/claimbridge.png' %}" type="image/x-icon" />
 <!-- [Font] Family -->
<link rel="stylesheet" href="{% static 'fonts/inter/inter.css' %}" id="main-font-link" />
<!-- [phosphor Icons] https://phosphoricons.com/ -->
<link rel="stylesheet" href="{% static 'fonts/phosphor/duotone/style.css' %}" />
<!-- [Tabler Icons] https://tablericons.com -->
<link rel="stylesheet" href="{% static 'fonts/tabler-icons.min.css' %}" />
<!-- [Feather Icons] https://feathericons.com -->
<link rel="stylesheet" href="{% static 'fonts/feather.css' %}" />
<!-- [Font Awesome Icons] https://fontawesome.com/icons -->
<link rel="stylesheet" href="{% static 'fonts/fontawesome.css' %}" />
<!-- [Material Icons] https://fonts.google.com/icons -->
<link rel="stylesheet" href="{% static 'fonts/material.css' %}" />
<!-- [Template CSS Files] -->
<link rel="stylesheet" href="{% static 'css/style.css'  %}" id="main-style-link"/>
<link rel="stylesheet" href="{% static 'css/style-preset.css' %}" />

<style>

/* Align search box to the right */
.dataTables_wrapper .dataTables_filter {
    float: right;
    /* text-align: right; */
}

/* Align length change dropdown to the left */
.dataTables_wrapper .dataTables_length {
    /* float: left; */
    display: inline-block;
    margin-right: 10px;
}



.dataTables_length select {
  display: inline;
  font-size: 1em;
  padding-inline: 22px;
  width: auto;
  display: flex;
  justify-content: space-between;
}





.form-control {
    font-size: 0.9rem;
}

.form-group {
    margin-bottom: 0.5rem;
}

label {
    font-size: 0.85rem;
}

.container {
    max-width: 100%;
    padding: 0 0.5rem;
}

.table {
    width: 100%;
    margin-bottom: 1rem;
    color: #212529;
    table-layout: fixed;
    
}

.table th,
.table td {
    padding: 0.75rem;
    vertical-align: top;
    border-top: 1px solid #dee2e6;
    word-wrap: break-word;
    white-space: normal;
    font-size: 13.2px;
}

.table thead th {
    vertical-align: top;
    border-bottom: 2px solid #dee2e6;
    font-size: 11px;
}

.table tbody + tbody {
    border-top: 2px solid #dee2e6;
}



.table-responsive {
    display: block;
    width: 110%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

.tooltip-inner {
    max-width: none;
    white-space: nowrap;
}
@media (max-width: 970px) {
            .table {
                table-layout: auto;
            }

            .table-responsive {
                overflow-x: auto;
            }
        }


        .modal-lg {
    max-width: 90%;
}

.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.5rem 1rem;
}

.nav-tabs .nav-link {
    margin-right: 5px;
    padding: 0.5rem 1rem;
    font-size: 14px;
}

#pdfViewerContainer {
    margin-top: 10px;
    height: 70vh;
    border-radius: 5px;
}




</style>


  </head>
  <!-- [Head] end -->
  <!-- [Body] Start -->

  <body data-pc-preset="preset-1" data-pc-sidebar-caption="true" data-pc-layout="vertical" data-pc-direction="ltr" data-pc-theme_contrast="" data-pc-theme="light">
    <!-- [ Pre-loader ] start -->
<div class="page-loader">
  <div class="bar"></div>
</div>
<!-- [ Pre-loader ] End -->
 <!-- [ Sidebar Menu ] start -->
<nav class="pc-sidebar">
  <div class="navbar-wrapper">
    <div class="m-header">
      <a href="/main/welcome/" class="b-brand text-primary">
        <!-- ========   Change your logo from here   ============ -->
        <img src="{% static 'images/claimbridge.png' %}" class="img-fluid" width="160px" alt="logo" />
        <span class="badge bg-light-success rounded-pill ms-2 theme-version"></span>
      </a>
    </div>
    <div class="navbar-content">
      <div class="card pc-user-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="flex-shrink-0">
              <img src="{% static 'images/user/avatar-1.jpg' %}" alt="user-image" class="user-avtar wid-45 rounded-circle" />
            </div>
            <div class="flex-grow-1 ms-3 me-2">
              <small>Hi</small>
              <h6 class="mb-0">{{ request.session.username }}</h6>
            </div>
            <a class="btn btn-icon btn-link-secondary avtar" data-bs-toggle="collapse" href="#pc_sidebar_userlink">
              <svg class="pc-icon">
                <use xlink:href="#custom-sort-outline"></use>
              </svg>
            </a>
          </div>
          <div class="collapse pc-user-links" id="pc_sidebar_userlink">
            <div class="pt-3">
              <a href="#!">
                <i class="ti ti-user"></i>
                <span>My Account</span>
              </a>
              <a href="#!">
                <i class="ti ti-settings"></i>
                <span>Settings</span>
              </a>
              <a href="#!">
                <i class="ti ti-lock"></i>
                <span>Lock Screen</span>
              </a>
              <a href="#!">
                <i class="ti ti-power"></i>
                <span>Logout</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <ul class="pc-navbar">
        <li class="pc-item pc-caption">
          <label></label>
        </li>
        <li class="pc-item">
          <a href="/main/welcome/" class="pc-link" data-toggle="tooltip" title="Dashboard">
            <span class="pc-micon">
              <svg class="pc-icon">
                <use xlink:href="#custom-story"></use>
              </svg>
            </span>
            <span class="pc-mtext"></span>
          </a>
        </li>
        <li class="pc-item pc-hasmenu">
          <a href="/main/registration/" class="pc-link" data-toggle="tooltip" title="Workflow">
            <span class="pc-micon">
              <svg class="pc-icon">
                <use xlink:href="#custom-fatrows"></use>
              </svg>
            </span>
            <span class="pc-mtext"></span>
             
          </a>
  
        </li>

        <!-- <li class="pc-item pc-hasmenu">
          <a href="/main/analytics/" class="pc-link" data-toggle="tooltip" title="Analytics">
            <span class="pc-micon">
              <svg class="pc-icon">
                <use xlink:href="#custom-status-up"></use>
              </svg>
            </span>
            <span class="pc-mtext"></span>
             </a>
   
        </li> -->

        <li class="pc-item pc-hasmenu">
          <a href="#" class="pc-link" data-toggle="tooltip" title="Analytics">
            <span class="pc-micon">
              <svg class="pc-icon">
                <use xlink:href="#custom-status-up"></use>
              </svg>
            </span>
            <span class="pc-mtext"></span>
             </a>
   
        </li>

        {% if request.session.usertype == 'admin' %}
            <li class="pc-item pc-hasmenu">
              <a href="/main/pricing_page/" class="pc-link" data-toggle="tooltip" title="Charges">
                <span class="pc-micon">
                  <svg class="pc-icon">
                    <use xlink:href="#custom-dollar-square"></use>
                  </svg>
                </span>
                <span class="pc-mtext"></span>
               
              </a>
           
            </li>
            {% endif %}

        <li class="pc-item pc-hasmenu">
          <a href="/main/logout/" class="pc-link" data-toggle="tooltip" title="Logout">
            <span class="pc-micon">
              <svg class="pc-icon me-2">
                <use xlink:href="#custom-logout-1-outline"></use>
              </svg>
            </span>
            <span class="pc-mtext"></span>
           
          </a>
       
        </li>
  </ul>
  <div>
    <h6 style="position: absolute; bottom: 0;">  <span> Powered by Droidal</span><span><img src="{% static 'images/favicon1.png' %}" alt="img" style="height: 20px; margin-bottom: 3px; margin-left: 4px;"></span></h6> 
  </div>
    </div>
  </div>
</nav>
<!-- [ Sidebar Menu ] end -->
 <!-- [ Header Topbar ] start -->
 <header class="pc-header" style="backdrop-filter: blur(0px); background: none; width: 20px; position: absolute !important;">
  <div class="ml-">
  <li class="pc-h-item pc-sidebar-collapse">
    <a href="#" class="pc-head-link ms-0" id="sidebar-hide">
      <i class="ti ti-menu-2"></i>
    </a>
  </li>
  <li class="pc-h-item pc-sidebar-popup">
    <a href="#" class="pc-head-link ms-0" id="mobile-collapse">
      <i class="ti ti-menu-2"></i>
    </a>
  </li>
</div>
</header>




    <!-- [ Main Content ] start -->
    <div class="pc-container" style="top: 4px;">
      <div class="pc-content">
        <div class="tab-content">
          <div class="tab-pane active" id="home">     
        <!-- [ Main Content ] start -->
        <div class="row" style="margin-left: -5px; max-width: 100%;">
          <div class="col-sm-12">
              <h4 class="m-t-0 header-title"><b>Medical Records Request Workflow</b></h4>
              <div class="card-box mt-4" style="margin-left: -40px;">
                <table id="datatable" class="table table-striped table-bordered">
                  <thead>
                      <tr>
                          <th data-toggle="tooltip" title="S.No" style="width: 6%;">S.No</th>
                          <th data-toggle="tooltip" title="Req Id" style="width: 6%;">Req Id</th>
                          <th data-toggle="tooltip" title="Patient No" style="width: 10%;">Patient No</th>
                          <th data-toggle="tooltip" title="First Name" style="width: 10%;">First Name</th>
                          <th data-toggle="tooltip" title="Last Name" style="width: 10%;">Last Name</th>
                          <th data-toggle="tooltip" title="Date of Birth" style="width: 10%;">DOB</th>
                          <th data-toggle="tooltip" title="Requestor Name" style="width: 10%;">Req Name</th>
                          <th data-toggle="tooltip" title="Requestor Email" style="width: 10%;">Req Email</th>
                          <th data-toggle="tooltip" title="Request Type" style="width: 10%;">Req Type</th>
                          <th data-toggle="tooltip" title="Created DateTime" style="width: 10%;">Req Created</th>
                          <th data-toggle="tooltip" title="Assigned To" style="width: 10%;">Assigned</th>
                          <th data-toggle="tooltip" title="Status" style="width: 10%;">Status</th>
                          <th data-toggle="tooltip" title="Remarks" style="width: 10%;">Remarks</th>
                          <th data-toggle="tooltip" title="Actions" style="width: 14%;">Actions</th>
                      </tr>
                  </thead>
                  <tbody>
                      {% for data in datas %}
                      <tr id="row-{{ data.request_id }}">
                          <td data-toggle="tooltip" title="{{ forloop.counter }}" style="width: 6%;">{{ forloop.counter }}</td>
                          <td data-toggle="tooltip" title="{{ data.request_id }}" style="width: 6%;">{{ data.request_id }}</td>
                          <td data-toggle="tooltip" title="{{ data.patient_no }}" style="width: 10%;">{{ data.patient_no }}</td>
                          <td data-toggle="tooltip" title="{{ data.patient_first_name }}" style="width: 10%;">{{ data.patient_first_name }}</td>
                          <td data-toggle="tooltip" title="{{ data.patient_last_name }}" style="width: 10%;">{{ data.patient_last_name }}</td>
                          <td data-toggle="tooltip" title="{{ data.patient_date_of_birth }}" style="width: 10%;">{{ data.patient_date_of_birth }}</td>
                          <td data-toggle="tooltip" title="{{ data.requestor_name }}" style="width: 10%;">{{ data.requestor_name }}</td>
                          <td data-toggle="tooltip" title="{{ data.requestor_email }}" style="width: 10%;">{{ data.requestor_email }}</td>
                          <td data-toggle="tooltip" title="{{ data.request_type }}" style="width: 10%;">{{ data.request_type }}</td>
                          <td data-toggle="tooltip" title="{{ data.ev_createddatetime|slice:":10" }}" style="width: 10%;">{{ data.external_request_createddatetime|slice:":10" }}</td>
                          <td id="assigned-{{ data.request_id }}" data-toggle="tooltip" title="{{ data.ev_assigned_to }}" style="width: 10%;">{{ data.ev_assigned_to }}</td>
                          <td id="status-{{ data.request_id }}" data-toggle="tooltip" title="{{ data.ev_status }}" style="width: 10%;">{{ data.ev_status }}</td>
                          <td id="remarks-{{ data.request_id }}" data-toggle="tooltip" title="{{ data.ev_remarks }}" style="width: 10%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">{{ data.ev_remarks }}</td>
              
                          <td class="actions text-center" style="width: 18%;">
                              {% if request.session.usertype == 'admin' %}
                              <input type="checkbox" class="btn-check flag-checkbox" id="btnchecklitecol{{ forloop.counter }}" data-flag-id="{{ data.request_id }}" {% if data.approve_doc_status == 'approved' %} checked {% endif %} onclick="toggleApproval(this, '{{ data.request_id }}')">
                              <label class="btn {% if data.approve_doc_status == 'approved' %}btn-white text-primary border-primary{% else %}btn-primary text-white border-darkblue{% endif %}" for="btnchecklitecol{{ forloop.counter }}" id="label-{{ data.request_id }}" style="font-size: 11px;">
                                  {% if data.approve_doc_status == 'approved' %}Approved{% else %}Pending{% endif %}
                              </label> <br>
              
                              <a href="javascript:void(0);" class="on-default remove-row" data-toggle="tooltip" title="Delete" style="color: #000000a8; font-size: 15px; margin-right: 4px;" 
                                onclick="confirmDelete('{{ data.request_id }}')"
                                onmouseover="this.style.color='#000000'" 
                                onmouseout="this.style.color='#000000a8'">
                                  <i class="fa fa-trash"></i>
                              </a>
                              <a href="/main/edit/{{ data.request_id }}" class="on-default edit-row" data-toggle="tooltip" title="Add Info" style="color: #000000a8; font-size: 15px; margin-right: 4px;" onmouseover="this.style.color='#000000'" 
                              onmouseout="this.style.color='#000000a8'"><i class="fa fa-plus"></i></a>
                              <!-- <a href="javascript:void(0);" onclick="viewMultiplePDFs('{{ data.request_id }}');" class="on-default download-row" data-toggle="tooltip" title="View" style="color: blue; font-size: 18px; margin-right: 4px;">
                                  <i class="fas fa-eye"></i>
                              </a> -->
                              <!-- <a href="javascript:void(0);" onclick="viewMultiplePDFs('{{ data.request_id }}');" class="on-default download-row" data-toggle="tooltip" title="View" style="color: blue; font-size: 18px; margin-right: 4px;">
                                <i class="fas fa-eye"></i>
                            </a> -->

                            <a href="javascript:void(0);" onclick="viewMultiplePDFs('{{ data.request_id }}');" class="on-default download-row" data-toggle="tooltip" title="View" style="color: #000000a8; font-size: 15px; margin-right: 4px;" onmouseover="this.style.color='#000000'" 
                            onmouseout="this.style.color='#000000a8'">
                              <i class="fas fa-eye"></i>
                            </a>
                          
                            
                              <!-- Settings Icon -->
                              <i id="settings-icon-{{ data.request_id }}" class="fas fa-tasks" data-toggle="tooltip" title="Status" style="color: #000000a8; cursor: pointer; font-size: 15px; {% if data.approve_doc_status == 'approved' %}display: none;{% endif %};" onclick="openSettingsModal('{{ data.request_id }}')" onmouseover="this.style.color='#000000'" 
                              onmouseout="this.style.color='#000000a8'"></i>
                              
                              <!-- User Plus Icon -->
                              <i id="user-plus-icon-{{ data.request_id }}" class="fas fa-user-plus" data-toggle="tooltip" title="Assign User" style="display: {% if data.approve_doc_status == 'approved' %}inline{% else %}none{% endif %}; color: #000000a8; cursor: pointer; font-size: 15px;" onclick="openAssignModal({{ data.request_id }})" data-bs-toggle="modal" data-bs-target="#animateModal" onmouseover="this.style.color='#000000'" 
                              onmouseout="this.style.color='#000000a8'"></i>
                              
                              {% elif request.session.usertype == 'Internal-user' %}
                              <a href="javascript:void(0);" onclick="viewMultiplePDFs('{{ data.request_id }}');" class="on-default download-row" data-toggle="tooltip" title="View" style="color: #000000a8; font-size: 15px; margin-right: 4px;" onmouseover="this.style.color='#000000'" 
                              onmouseout="this.style.color='#000000a8'">
                                  <i class="fas fa-eye"></i>
                              </a>
                              <a href="/main/edit/{{ data.request_id }}" class="on-default edit-row" data-toggle="tooltip" title="Add Info" style="color: #000000a8; font-size: 15px; margin-right: 4px;" onmouseover="this.style.color='#000000'" 
                              onmouseout="this.style.color='#000000a8'"><i class="fa fa-plus"></i></a><br>
                              <button class="btn btn-primary" data-toggle="tooltip" title="Move to" onclick="openMoveToModal('{{ data.request_id }}')" style="margin-left: 5px; padding: -5px; border-radius: 5px; font-size: 11px;">Move to</button>
                              
                              {% endif %}
                          </td>
                      </tr>
                      {% endfor %}
                  </tbody>
              </table>
              </div>
          </div>
      </div>
      




<!-- Move to Modal -->

<div class="modal fade" id="moveToModal" tabindex="-1" aria-labelledby="moveToModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="moveToModalLabel">Update Status</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <form id="moveToForm">
                  <div class="mb-3">
                      <label for="statusSelect" class="form-label">Status</label>
                      <select id="statusSelect" class="form-select">
                          <option value="">-Select Status-</option>
                          <option value="Completed">Completed</option>
                          
                          <option value="Error">Error</option>
                      </select>
                  </div>
                  <div class="mb-3">
                      <label for="remarksInput" class="form-label">Remarks</label>
                      <textarea id="remarksInput" class="form-control"></textarea>
                  </div>
              </form>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" onclick="saveStatusMoveTo()">Save changes</button>
          </div>
      </div>
  </div>
</div>


<!-- Move to modal ends -->


<div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="settingsModalLabel">Update Status</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="moveToForm" data-request-id="">
          <div class="mb-3">
            <label for="newStatusSelect" class="form-label">Status</label>
            <select id="newStatusSelect" class="form-select">
              <option value="">-Select Status-</option>
              <option value="Rejected">Rejected</option>
              <option value="Legal Hold">Legal Hold</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="newRemarksInput" class="form-label">Remarks</label>
            <textarea id="newRemarksInput" class="form-control"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="saveStatus()">Save changes</button>
      </div>
    </div>
  </div>
</div>










      <!-- ASSIGNING BOX start -->
      <div class="modal fade modal-animate" id="animateModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Assign User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"> </button>
                </div>
                <div class="modal-body">
                    <label for="userDropdown" class="form-label" style="margin-right: 7%;">Select User</label>
                    
                    <div class="dropdown">
                        <input type="text" class="form-control dropdown-toggle" id="userInput" data-bs-toggle="dropdown" aria-expanded="false" placeholder="Users" readonly>
                        <ul class="dropdown-menu" aria-labelledby="userInput">
                            {% for user in users %}
                            <li style="width: 445px; justify-content: center; align-items: center;"><a class="dropdown-item" style="justify-content: center; align-items: center;" href="#" onclick="selectUser('{{ user.user_id }}', '{{ user.user_username }}')">{{ user.user_username }}</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                    <input type="hidden" id="selectedUserId" name="selectedUserId">
                    <input type="hidden" id="selectedUserName" name="selectedUserName">
                    <input type="hidden" id="currentRequestId">
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal" style="border-radius: 5px;">Close</button>
                    <button type="button" class="btn btn-primary shadow-2" style="border-radius: 5px;" onclick="saveChanges()">Save changes</button>
                </div>
            </div>
        </div>
    </div>
      <!--  ASSIGNING BOX end -->






      <!-- PDF MODAL STARTS -->

      <!-- Modal Structure -->
<!-- <div class="modal fade" id="pdfModal" tabindex="-1" aria-labelledby="pdfModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="pdfModalLabel">Available PDF Files</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <ul id="pdfList" class="list-group">

        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="downloadAllBtn">Download All</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        
    </div>
    
    </div>
  </div>
</div> -->



<!-- Modal Structure -->
<!-- Modal Structure -->
<div class="modal fade" id="pdfModal" tabindex="-1" role="dialog" aria-labelledby="pdfModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <ul id="pdfTabs" class="nav nav-tabs w-100"></ul>
              <div class="ml-auto d-flex align-items-center">
                  <button id="downloadAllBtn" class="btn btn-primary" onclick="downloadAllPDFs()">Download</button>
                  <button type="button" class="close ml-2" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                  </button>
              </div>
          </div>
          <div class="modal-body">
              <div id="pdfViewerContainer" style="width: 100%; height: 70vh; border: 1px solid #ccc;">
                  <iframe id="pdfViewer" style="width: 100%; height: 100%; border: none;"></iframe>
              </div>
          </div>
          <!-- <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div> -->
      </div>
  </div>
</div>







      <!-- PDF MODAL ENDS -->

                        </div>
                        <div class="tab-pane" id="messages">
                            <p>Statistics Content</p>
                             
                        </div>
                        <div class="tab-pane" id="settings">
                            <p>Online Manual Content</p>
                        </div>
                    </div>
                </div> 

        </div>
        <!-- end row -->






        <div id="custom-width-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="custom-width-modalLabel" aria-hidden="true" style="display: none;">
          <div class="modal-dialog" style="width:55%;">
              <div class="modal-content">
                  <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                      <h4 class="modal-title" id="custom-width-modalLabel">Update Status</h4>
                  </div> 
                  <form method="GET" action="{% url 'upstreamstatusupdatereg' %}" >
                      {% csrf_token %}
                  <div class="modal-body">
                      <input type="hidden" name="remarkid" id="remarkid" />
                      
                      <div class="form-group" style="margin-top: 2%;">
                          <label class="col-md-2 control-label">Status</label>
                          <div class="col-md-10">
                              <select class="form-control" id="status" name="status" required>
                                  <option value="">-Select Status -</option>
                                  {% if  request.session.usertype != 'rcm' %}  
                                  <option value="Completed">Completed</option>
                                  
                                  <option value="Error">Error</option>
                                  {% endif %}
                                  {% if  request.session.usertype == 'rcm' %}  
                                  <option value="In-Review">In-Review</option>
                                  <option value="Completed">Completed</option>
                                  
                                  <option value="Error">Error</option>
                                  {% endif %}
                              </select>
                          </div>
                      </div>
                      <div class="form-group"  style="margin-top: 10%;">
                          <label class="col-md-2 control-label">Remarks</label>
                          <div class="col-md-10">
                              <textarea name="remarks" id="remarks" class="form-control">None</textarea>
                          </div>
                      </div>

                  </div>   
                  <div class="modal-footer" style="border: 0px !important;" > 
                      <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Close</button>
                      <button type="submit" class="btn btn-primary waves-effect waves-light">Save changes</button>
                  </div>
              </form> 
                   
              </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
      </div>

      <div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
          <div class="modal-dialog">
              <div class="modal-content">
                  <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                      <h4 class="modal-title" id="myModalLabel">Assign User</h4>
                  </div>
                  <div class="modal-body">
                      <form   class="form-horizontal" role="form" >
                          <div class="form-group">
                              <label class="col-md-2 control-label" for="example-email">Select User</label>
                              <div class="col-md-10">
                                  <select class="form-control" id="assign_user" name="assign_user">
                                      <option value="">-Select User-</option>
                                       {% for user in users %}   
                                       <option value="{{ user.user_id }}">{{ user.user_username }}</option>
                                       
                                       {% endfor %}
                                  </select>
                              </div>
                          </div>
                      </form>
                       
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Close</button>
                      <button type="button" onclick="assign_user()"  id="assign_sub" class="btn btn-primary waves-effect waves-light">Save changes</button>
                  </div>
              </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
      </div>
<!-- [ Main Content ] start -->
           
           
<div class="pct-c-btn" style="display: none;">
  <a href="#" data-bs-toggle="offcanvas" data-bs-target="#offcanvas_pc_layout">
    <i class="ph-duotone ph-gear-six"></i>
  </a>
</div>
<div class="offcanvas border-0 pct-offcanvas offcanvas-end" tabindex="-1" id="offcanvas_pc_layout">
<div class="offcanvas-header">
<h5 class="offcanvas-title">Settings</h5>
<button type="button" class="btn btn-icon btn-link-danger ms-auto" data-bs-dismiss="offcanvas" aria-label="Close"
  ><i class="ti ti-x"></i
></button>
</div>
<div class="pct-body customizer-body">
<div class="offcanvas-body py-0">
  <ul class="list-group list-group-flush">
    <li class="list-group-item">
      <div class="pc-dark">
        <h6 class="mb-1">Theme Mode</h6>
        <p class="text-muted text-sm">Choose light or dark mode or Auto</p>
        <div class="row theme-color theme-layout">
          <div class="col-4">
            <div class="d-grid">
              <button
                class="preset-btn btn active"
                data-value="true"
                onclick="layout_change('light');"
                data-bs-toggle="tooltip"
                title="Light"
              >
                <svg class="pc-icon text-warning">
                  <use xlink:href="#custom-sun-1"></use>
                </svg>
              </button>
            </div>
          </div>
          <div class="col-4">
            <div class="d-grid">
              <button class="preset-btn btn" data-value="false" onclick="layout_change('dark');" data-bs-toggle="tooltip" title="Dark">
                <svg class="pc-icon">
                  <use xlink:href="#custom-moon"></use>
                </svg>
              </button>
            </div>
          </div>
          <div class="col-4">
            <div class="d-grid">
              <button
                class="preset-btn btn"
                data-value="default"
                onclick="layout_change_default();"
                data-bs-toggle="tooltip"
                title="Automatically sets the theme based on user's operating system's color scheme."
              >
                <span class="pc-lay-icon d-flex align-items-center justify-content-center">
                  <i class="ph-duotone ph-cpu"></i>
                </span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </li>
    <li class="list-group-item">
      <h6 class="mb-1">Theme Contrast</h6>
      <p class="text-muted text-sm">Choose theme contrast</p>
      <div class="row theme-contrast">
        <div class="col-6">
          <div class="d-grid">
            <button
              class="preset-btn btn"
              data-value="true"
              onclick="layout_theme_contrast_change('true');"
              data-bs-toggle="tooltip"
              title="True"
            >
              <svg class="pc-icon">
                <use xlink:href="#custom-mask"></use>
              </svg>
            </button>
          </div>
        </div>
        <div class="col-6">
          <div class="d-grid">
            <button
              class="preset-btn btn active"
              data-value="false"
              onclick="layout_theme_contrast_change('false');"
              data-bs-toggle="tooltip"
              title="False"
            >
              <svg class="pc-icon">
                <use xlink:href="#custom-mask-1-outline"></use>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </li>
    <li class="list-group-item">
      <h6 class="mb-1">Custom Theme</h6>
      <p class="text-muted text-sm">Choose your primary theme color</p>
      <div class="theme-color preset-color">
        <a href="#!" data-bs-toggle="tooltip" title="Blue" class="active" data-value="preset-1"><i class="ti ti-checks"></i></a>
        <a href="#!" data-bs-toggle="tooltip" title="Indigo" data-value="preset-2"><i class="ti ti-checks"></i></a>
        <a href="#!" data-bs-toggle="tooltip" title="Purple" data-value="preset-3"><i class="ti ti-checks"></i></a>
        <a href="#!" data-bs-toggle="tooltip" title="Pink" data-value="preset-4"><i class="ti ti-checks"></i></a>
        <a href="#!" data-bs-toggle="tooltip" title="Red" data-value="preset-5"><i class="ti ti-checks"></i></a>
        <a href="#!" data-bs-toggle="tooltip" title="Orange" data-value="preset-6"><i class="ti ti-checks"></i></a>
        <a href="#!" data-bs-toggle="tooltip" title="Yellow" data-value="preset-7"><i class="ti ti-checks"></i></a>
        <a href="#!" data-bs-toggle="tooltip" title="Green" data-value="preset-8"><i class="ti ti-checks"></i></a>
        <a href="#!" data-bs-toggle="tooltip" title="Teal" data-value="preset-9"><i class="ti ti-checks"></i></a>
        <a href="#!" data-bs-toggle="tooltip" title="Cyan" data-value="preset-10"><i class="ti ti-checks"></i></a>
      </div>
    </li>
    <li class="list-group-item">
      <h6 class="mb-1">Theme layout</h6>
      <p class="text-muted text-sm">Choose your layout</p>
      <div class="theme-main-layout d-flex align-center gap-1 w-100">
        
        <a href="#!" data-bs-toggle="tooltip" title="Horizontal" data-value="horizontal">
          <img src="{% static 'images/customizer/horizontal.svg' %}" alt="img" class="img-fluid" />
        </a>
        <a href="#!" data-bs-toggle="tooltip" title="Color Header" data-value="color-header">
          <img src="{% static 'images/customizer/color-header.svg' %}" alt="img" class="img-fluid" />
        </a>
        <a href="#!" data-bs-toggle="tooltip" title="Compact" data-value="compact">
        </a>
        <a href="#!" data-bs-toggle="tooltip" title="Tab" data-value="tab">
          <img src="{% static 'images/customizer/tab.svg' %}" alt="img" class="img-fluid" />
        </a>
      </div>
    </li>
    <li class="list-group-item">
      <h6 class="mb-1">Sidebar Caption</h6>
      <p class="text-muted text-sm">Sidebar Caption Hide/Show</p>
      <div class="row theme-color theme-nav-caption">
        <div class="col-6">
          <div class="d-grid">
            <button
              class="preset-btn btn-img btn active"
              data-value="true"
              onclick="layout_caption_change('true');"
              data-bs-toggle="tooltip"
              title="Caption Show"
            >
              <img src="{% static 'images/customizer/caption-on.svg' %}" alt="img" class="img-fluid" />
            </button>
          </div>
        </div>
        <div class="col-6">
          <div class="d-grid">
            <button
              class="preset-btn btn-img btn"
              data-value="false"
              onclick="layout_caption_change('false');"
              data-bs-toggle="tooltip"
              title="Caption Hide"
            >
              <img src="{% static 'images/customizer/caption-off.svg' %}" alt="img" class="img-fluid" />
            </button>
          </div>
        </div>
      </div>
    </li>
    <li class="list-group-item">
      <div class="pc-rtl">
        <h6 class="mb-1">Theme Layout</h6>
        <p class="text-muted text-sm">LTR/RTL</p>
        <div class="row theme-color theme-direction">
          <div class="col-6">
            <div class="d-grid">
              <button
                class="preset-btn btn-img btn active"
                data-value="false"
                onclick="layout_rtl_change('false');"
                data-bs-toggle="tooltip"
                title="LTR"
              >
                <img src="{% static 'images/customizer/ltr.svg' %}" alt="img" class="img-fluid" />
              </button>
            </div>
          </div>
          <div class="col-6">
            <div class="d-grid">
              <button
                class="preset-btn btn-img btn"
                data-value="true"
                onclick="layout_rtl_change('true');"
                data-bs-toggle="tooltip"
                title="RTL"
              >
                <img src="{% static 'images/customizer/rtl.svg' %}" alt="img" class="img-fluid" />
              </button>
            </div>
          </div>
        </div>
      </div>
    </li>
    <li class="list-group-item pc-box-width">
      <div class="pc-container-width">
        <h6 class="mb-1">Layout Width</h6>
        <p class="text-muted text-sm">Choose Full or Container Layout</p>
        <div class="row theme-color theme-container">
          <div class="col-6">
            <div class="d-grid">
              <button
                class="preset-btn btn-img btn active"
                data-value="false"
                onclick="change_box_container('false')"
                data-bs-toggle="tooltip"
                title="Full Width"
              >
                <img src="{% static 'images/customizer/full.svg' %}" alt="img" class="img-fluid" />
              </button>
            </div>
          </div>
          <div class="col-6">
            <div class="d-grid">
              <button
                class="preset-btn btn-img btn"
                data-value="true"
                onclick="change_box_container('true')"
                data-bs-toggle="tooltip"
                title="Fixed Width"
              >
                <img src="{% static 'images/customizer/fixed.svg' %}" alt="img" class="img-fluid" />
              </button>
            </div>
          </div>
        </div>
      </div>
    </li>
    <li class="list-group-item">
      <div class="d-grid">
        <button class="btn btn-light-danger" id="layoutreset">Reset Layout</button>
      </div>
    </li>
  </ul>
</div>
</div>
</div>


<script>
localStorage.setItem('layout', 'compact');
</script>
<!-- [Page Specific JS] start -->
<script src="{% static 'js/layout-compact.js' %}"></script>

      
    <!-- [ Main Content ] end -->
    <footer class="pc-footer">
      <div class="footer-wrapper container-fluid">
        <div class="row">
         
        
        </div>
      </div>
    </footer>
 

    <!-- [Page Specific JS] start -->
    <!-- <script src="{% static 'js/plugins/apexcharts.min.js' %}"></script> -->
    <!-- <script src="{% static 'js/pages/dashboard-default.js' %}"></script> -->
    <!-- [Page Specific JS] end -->
    <!-- Required Js -->
    <script src="{% static 'js/plugins/popper.min.js' %}"></script>
    <script src="{% static 'js/plugins/simplebar.min.js' %}"></script>
    <script src="{% static 'js/plugins/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/fonts/custom-font.js' %}"></script>
    <script src="{% static 'js/pcoded.js' %}"></script>
    <script src="{% static 'js/plugins/feather.min.js' %}"></script>
     <!-- jQuery and DataTables JS -->
     <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
     <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
     <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <script>
      
    </script>
    <script>
      layout_change('light');
    </script>
      
    <script>
      change_box_container('false');
    </script>
     
    <script>
      layout_caption_change('true');
    </script>
     
    <script>
      layout_rtl_change('false');
    </script>
     
    <script>
      preset_change('preset-1');
    </script>
     
    <script>
      main_layout_change('vertical');
    </script>


    


    {{ files_dict|json_script:"fileUrls" }}
    
    <script type="text/javascript">
        
        $(document).ready(function() {
        $('#datatable').DataTable({
            "paging": true,
            "lengthChange": true,
            "searching": true,
            "ordering": true,
            "info": false,
            "autoWidth": false,
            "responsive": true,
            "order": [], // Default order (no initial sorting)
            "columnDefs": [
                {
                    "targets": '_all', // Apply to all columns
                    "orderable": true // Enable sorting
                }
            ]
        });
    
        $('.dataTables_length label').contents().filter(function() {
            return this.nodeType === 3; 
        }).each(function() {
            this.textContent = this.textContent.replace(/entries/, ''); 
            this.textContent = this.textContent.replace(/Show/, ''); 
        });
    
        $('.dataTables_length label').prepend(' Show Entries');
    });
    
    
    
    function openSettingsModal(requestId) {
        // Set the request ID in the form's data attribute
        document.getElementById('moveToForm').dataset.requestId = requestId;
    
    
        var settingsModal = new bootstrap.Modal(document.getElementById('settingsModal'));
        settingsModal.show();
    }
    
    
        function complete(id){    
            swal({
                title: "Are you sure?",
                text: "Complete the EV Request",
                icon: "warning",
                buttons: true,
                dangerMode: true,
              })
              .then((willDelete) => {
                if (willDelete) {
                    window.location.href="/complete/"+id
                } else {
                  swal("Cancelled!..");
                  return false
                }
              });
        }
    
        function errorupdate(id){    
            swal({
                title: "Are you sure?",
                text: "Update EV Request as Invalid",
                icon: "warning",
                buttons: true,
                dangerMode: true,
              })
              .then((willDelete) => {
                if (willDelete) {
                    window.location.href="/error/"+id
                } else {
                  swal("Cancelled!..");
                  return false
                }
              });
        }
    
        function inprogress(id){
            swal({
                title: "Are you sure?",
                text: "Update EV Request as In-Progress",
                icon: "warning",
                buttons: true,
                dangerMode: true,
              })
              .then((willDelete) => {
                if (willDelete) {
                    window.location.href="/inprogress/"+id
                } else {
                  swal("Cancelled!..");
                  return false
                }
              });
    
        }
    
        function update_ev(id){ 
            sessionStorage.setItem("updateev", id);
            $('#remarkid').val(id);
        }
    
        function update_remark_ev(id,remarks){
            $('#remarkid').val(id);
            $('#remarks').val(remarks) 
        }
    
        function assign_user(){
            id=sessionStorage.getItem("updateev")
            assignuserid=$('#assign_user').val()
            if(assignuserid==""){
                alert('Select User')
                return false;
            }
    
            window.location.href="/upstreamassignuser/"+id+"/"+assignuserid
        }
    
        $('.flag-checkbox').change(function() {
        var requestId = $(this).data('flag-id');
        var isChecked = this.checked;
    
        // Update the icon visibility based on the checkbox state
        var settingsIcon = $('#settings-icon-' + requestId);
        var userPlusIcon = $('#user-plus-icon-' + requestId);
    
        if (isChecked) {
            settingsIcon.hide();
            userPlusIcon.show();
        } else {
            settingsIcon.show();
            userPlusIcon.hide();
        }
    
        
    });
    
    
    
        function selectUser(userId, userName) {
            document.getElementById('selectedUserId').value = userId;
            document.getElementById('selectedUserName').value = userName;
            document.getElementById('userInput').value = userName;
        }
    
        function openAssignModal(requestId) {
            document.getElementById('currentRequestId').value = requestId;
        }
    
        function saveChanges() {
            var requestId = document.getElementById('currentRequestId').value;
            var selectedUserId = document.getElementById('selectedUserId').value;
            var selectedUserName = document.getElementById('selectedUserName').value;
            
            if (selectedUserId && selectedUserName) {
                // Update the table cell values
                document.getElementById('assigned-' + requestId).innerText = selectedUserName;
                document.getElementById('status-' + requestId).innerText = 'In Progress';
                
                // Send an AJAX request to update the status in the backend
                $.ajax({
                    url: '/main/update_request_status/',
                    method: 'POST',
                    data: {
                        request_id: requestId,
                        assigned_to: selectedUserName,
                        status: 'In Progress',
                        csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                    success: function(response) {
                        if (response.success) {
                            // alert(response.message);
                            // Close the modal
                            var modal = bootstrap.Modal.getInstance(document.getElementById('animateModal'));
                            modal.hide();
    
                        } else {
                            alert(response.message);
                        }
                    },
                    error: function(response) {
                        alert('An error occurred while updating the request.');
                    }
                });
            } else {
                alert('Please select a user.');
            }
        }
    
        function toggleApproval(checkbox, requestId) {
        var label = document.getElementById('label-' + requestId);
        var statusElement = document.getElementById('status-' + requestId);
        var newStatus = checkbox.checked ? 'approved' : 'Pending';
        var saveStatus = 'New'
    
        // Confirm approval if the checkbox is checked
        if (checkbox.checked) {
            var confirmation = confirm("Do you want to Approve the status?");
            if (!confirmation) {
                // If the user clicks "Cancel", revert the checkbox state and return
                checkbox.checked = false;
                return;
            }
    
            label.innerText = 'Approved';
            label.classList.remove('btn-primary', 'text-white', 'border-darkblue');
            label.classList.add('btn-white', 'text-primary', 'border-primary');
    
            // Update status column to 'Approved'
            if (statusElement) {
                statusElement.textContent = 'New';
            }
        } else {
            label.innerText = 'Pending';
            label.classList.remove('btn-white', 'text-primary', 'border-primary');
            label.classList.add('btn-primary', 'text-white', 'border-darkblue');
        }
    
        // Send AJAX request to update the approval status
        $.ajax({
            url: '/main/toggle_approval/',
            method: 'POST',
            data: {
                request_id: requestId,
                approve_status: newStatus,
                saveStatus: saveStatus,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function(response) {
                alert(response.message);
            },
            error: function(response) {
                alert('An error occurred while updating the approval status.');
            }
        });
    }
    
    
    
    
    
    
        function openMoveToModal(requestId) {
        // Store the current request ID
        document.getElementById('moveToForm').dataset.requestId = requestId;
        
        // Clear previous input values
        document.getElementById('statusSelect').value = '';
        document.getElementById('remarksInput').value = '';
        
        // Show the modal
        var moveToModal = new bootstrap.Modal(document.getElementById('moveToModal'), {
            keyboard: false
        });
        moveToModal.show();
    }
    
    function saveStatus() {
        // Get the current request ID from the form
        const requestId = document.getElementById('moveToForm').dataset.requestId;
        
        // Get input values
        const status = document.getElementById('newStatusSelect').value;
        const remarks = document.getElementById('newRemarksInput').value;
        
        console.log('Status:', status);
        console.log('Remarks:', remarks);
        
        if (status === '' || remarks === '') {
            alert('Please fill in all fields');
            return;
        }
        
        // Send the data to the server using fetch or AJAX
        fetch('/main/updateStatus/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify({
                request_id: requestId,
                status: status,
                remarks: remarks
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update the table row with new status and remarks
                const statusElement = document.getElementById('status-' + requestId);
                const remarksElement = document.getElementById('remarks-' + requestId);
                
                if (statusElement) {
                    statusElement.textContent = status;
                } else {
                    console.error('Status element not found for request ID:', requestId);
                }
                
                if (remarksElement) {
                    remarksElement.textContent = remarks;
                } else {
                    console.error('Remarks element not found for request ID:', requestId);
                }
                
                // Hide the modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('settingsModal'));
                modal.hide();
            } else {
                alert('Error updating status');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    
    
    
    
    function saveStatusMoveTo() {
        // Get the current request ID
        const requestId = document.getElementById('moveToForm').dataset.requestId;
        
        // Get input values
        const status = document.getElementById('statusSelect').value;
        const remarks = document.getElementById('remarksInput').value;
        
        if (status === '' || remarks === '') {
            alert('Please fill in all fields');
            return;
        }
        
        // Send the data to the server using fetch or AJAX
        fetch('/main/updateStatus2/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify({
                request_id: requestId,
                status: status,
                remarks: remarks
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update the table row with new status and remarks
                const statusElement = document.getElementById('status-' + requestId);
                const remarksElement = document.getElementById('remarks-' + requestId);
                
                if (statusElement) {
                    statusElement.textContent = status;
                } else {
                    console.error('Status element not found for request ID:', requestId);
                }
                
                if (remarksElement) {
                    remarksElement.textContent = remarks;
                } else {
                    console.error('Remarks element not found for request ID:', requestId);
                }
                
                // Hide the modal
                var moveToModal = bootstrap.Modal.getInstance(document.getElementById('moveToModal'));
                moveToModal.hide();
            } else {
                alert('Error updating status');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    
    
    // function viewMultiplePDFs(requestId) {
    //     const fileUrls = JSON.parse(document.getElementById('fileUrls').textContent);
    //     const urls = fileUrls[requestId];

    //     if (urls && urls.length > 0) {
    //         urls.forEach(url => {
    //             // Ensure the URL starts from the site root by forcing an absolute path
    //             const absoluteUrl = url.startsWith('/') ? url : '/' + url;
    //             window.open("{{ MEDIA_URL }}" + absoluteUrl, '_blank');
    //         });
    //     } else {
    //         alert("No files available for this request.");
    //     }
    // }


    // function downloadMultiplePDFs(requestId) {
    //     const fileUrls = JSON.parse(document.getElementById('fileUrls').textContent);
    //     const urls = fileUrls[requestId];

    //     if (urls && urls.length > 0) {
    //         urls.forEach(url => {
    //             // Ensure the URL starts from the site root by forcing an absolute path
    //             const absoluteUrl = url.startsWith('/') ? url : '/' + url;
    //             const downloadUrl = "{{ MEDIA_URL }}" + absoluteUrl;

    //             // Create a temporary anchor element
    //             const a = document.createElement('a');
    //             a.href = downloadUrl;
    //             a.download = ''; // Setting download attribute triggers download
    //             document.body.appendChild(a);
    //             a.click();
    //             document.body.removeChild(a);
    //         });
    //     } else {
    //         alert("No files available for this request.");
    //     }
    // }
    
    

    document.addEventListener('DOMContentLoaded', function() {
    function viewMultiplePDFs(requestId) {
        const fileUrls = JSON.parse(document.getElementById('fileUrls').textContent);
        const urls = fileUrls[requestId];
        const pdfTabs = document.getElementById('pdfTabs');
        const pdfViewer = document.getElementById('pdfViewer');
        
        // Clear existing tabs and PDF viewer
        if (pdfTabs) pdfTabs.innerHTML = '';
        if (pdfViewer) pdfViewer.src = '';

        if (urls && urls.length > 0) {
            urls.forEach((url, index) => {
                const fileName = url.split('\\').pop().split('/').pop();
                const absoluteUrl = url.startsWith('/') ? url.replace(/\\/g, '/') : '/' + url.replace(/\\/g, '/');

                // Create a tab-like item for each PDF
                const tabLink = document.createElement('a');
                tabLink.className = 'nav-link';
                tabLink.href = '#';
                tabLink.textContent = fileName;
                tabLink.style.cursor = 'pointer';
                tabLink.onclick = function() {
                    pdfViewer.src = absoluteUrl;
                    // Remove 'active' class from all tabs and add to the clicked tab
                    document.querySelectorAll('#pdfTabs .nav-link').forEach(link => {
                        if (link) link.classList.remove('active');
                    });
                    tabLink.classList.add('active');
                };

                if (index === 0) {
                    tabLink.classList.add('active');
                    pdfViewer.src = absoluteUrl;  // Load the first PDF by default
                }

                if (pdfTabs) pdfTabs.appendChild(tabLink);
            });

            // Store the URLs globally for downloading
            window.currentPdfUrls = urls;

            // Show the modal
            $('#pdfModal').modal('show');
        } else {
            alert("No files available for this request.");
        }
    }

    function downloadAllPDFs() {
        if (!window.currentPdfUrls || window.currentPdfUrls.length === 0) {
            alert("No files available to download.");
            return;
        }

        const zip = new JSZip();
        const pdfFolder = zip.folder("pdfs");

        let count = 0;
        window.currentPdfUrls.forEach((url, index) => {
            const fileName = url.split('\\').pop().split('/').pop();
            const absoluteUrl = url.startsWith('/') ? url.replace(/\\/g, '/') : '/' + url.replace(/\\/g, '/');

            JSZipUtils.getBinaryContent(absoluteUrl, function(err, data) {
                if (err) {
                    console.error(`Failed to download ${fileName}: ${err}`);
                    return;
                }

                pdfFolder.file(fileName, data, { binary: true });
                count++;

                if (count === window.currentPdfUrls.length) {
                    zip.generateAsync({ type: "blob" }).then(function(content) {
                        saveAs(content, "all_pdfs.zip");
                    });
                }
            });
        });
    }

    // Attach the functions to the window object to make them globally accessible
    window.viewMultiplePDFs = viewMultiplePDFs;
    window.downloadAllPDFs = downloadAllPDFs;






    // Function to download all PDFs in a ZIP file
    // function downloadAllPDFs(requestId) {
    //     const fileUrls = JSON.parse(document.getElementById('fileUrls').textContent);
    //     const urls = fileUrls[requestId];

    //     if (urls && urls.length > 0) {
    //         window.location.href = `/download-all-pdfs/${requestId}/`;  // Assuming you have set up this URL in your Django views
    //     } else {
    //         alert("No files available for this request.");
    //     }
    // }

    // // Attaching the functions to global scope so that they can be called from HTML
    // window.viewMultiplePDFs = viewMultiplePDFs;
    // window.downloadAllPDFs = downloadAllPDFs;
});



// Function to download all PDFs as a ZIP file
// function downloadAllPDFsAsZip(requestId) {
//     // Trigger the server-side generation of the ZIP file
//     window.location.href = `/download-all-pdfs/${requestId}/`;
// }

// Event listener for the "Download All" button in the modal
// document.getElementById('downloadAllBtn').addEventListener('click', function() {
//     const requestId = document.getElementById('pdfModal').dataset.requestId; // Get the requestId from the modal
//     downloadAllPDFsAsZip(requestId);
// });

// Event listener to close the modal when clicking the close button
document.querySelectorAll('#pdfModal .close, #pdfModal .btn-secondary').forEach(button => {
    button.addEventListener('click', function() {
        $('#pdfModal').modal('hide');
    });
});


function downloadMultiplePDFs(requestId) {
    const fileUrls = JSON.parse(document.getElementById('fileUrls').textContent);
    const urls = fileUrls[requestId];

    if (urls && urls.length > 0) {
        urls.forEach(url => {
            // Ensure the URL starts from the site root by forcing an absolute path
            const absoluteUrl = url.startsWith('/') ? url : '/' + url;
            const downloadUrl = "{{ MEDIA_URL }}" + absoluteUrl;

            // Create a temporary anchor element
            const a = document.createElement('a');
            a.href = downloadUrl;
            a.download = ''; // Setting download attribute triggers download
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });
    } else {
        alert("No files available for this request.");
    }
}

    
    
    
    function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    
        function confirmDelete(requestId) {
            const result = confirm("Are you sure you want to delete this request?");
            if (result) {
                
                $.ajax({
                    url: '/main/deleteupstream/' + requestId + '/',
                    type: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    success: function(response) {
                        if (response.status === 'success') {
                            // Remove the row from the table
                            $('#row-' + requestId).remove();
                            // alert('Request deleted successfully.');
                            location.reload()
                        } else {
                            alert('An error occurred: ' + response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        alert('An error occurred while deleting the request.');
                    }
                });
            }
        }
    
    
    
    
    </script>













  </body>
  <!-- [Body] end -->
</html>

