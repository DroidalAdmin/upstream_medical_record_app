
{% load static %}
    
 
<!doctype html>
<html lang="en">
  <!-- [Head] start -->

  <head>
    <title>Home | droi</title>
    <!-- [Meta] -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />


    <!-- [Favicon] icon -->
    <link rel="icon" href="{% static 'images/claimbridge.png' %}" type="image/x-icon" />
 <!-- [Font] Family -->
<link rel="stylesheet" href="{% static 'fonts/inter/inter.css' %}" id="main-font-link" />
<!-- [phosphor Icons] https://phosphoricons.com/ -->
<link rel="stylesheet" href="{% static 'fonts/phosphor/duotone/style.css' %}" />
<!-- [Tabler Icons] https://tablericons.com -->
<link rel="stylesheet" href="{% static 'fonts/tabler-icons.min.css' %}" />
<!-- [Feather Icons] https://feathericons.com -->
<link rel="stylesheet" href="{% static 'fonts/feather.css' %}" />
<!-- [Font Awesome Icons] https://fontawesome.com/icons -->
<link rel="stylesheet" href="{% static 'fonts/fontawesome.css' %}" />
<!-- [Material Icons] https://fonts.google.com/icons -->
<link rel="stylesheet" href="{% static 'fonts/material.css' %}" />
<!-- [Template CSS Files] -->
<link rel="stylesheet" href="{% static 'css/style.css'  %}" id="main-style-link"/>
<link rel="stylesheet" href="{% static 'css/style-preset.css' %}" />

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<!-- Optional theme -->
<!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap-theme.min.css"> -->
<script src="https://cdn.jsdelivr.net/npm/progressbar.js"></script>

<style>

#save-pages {
    position: absolute;
    top: 50%;
    right: 10px;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    color: #6c757d;
}


/* Progress bar container styling */
#new-loading {
    display: none; /* Hidden initially */
    margin: 30px 0;
}

#progress-container {
    width: 100%;
    height: 20px;
    background-color: #f3f3f3;
    border-radius: 10px;
    margin-top: 10px;
    display: none; /* Hidden initially */
}

#progress-bar {
    height: 100%;
    width: 0;
    background-color: #2E6CD8;
    transition: width 0.4s ease;
    text-align: center;
    color: white;
    line-height: 20px;
    font-weight: bold;
}


/* Animate the glow effect */
@keyframes progressGlow {
    0% {
        box-shadow: 0 0 5px rgba(0, 180, 219, 0.5);
    }
    50% {
        box-shadow: 0 0 20px rgba(0, 180, 219, 1);
    }
    100% {
        box-shadow: 0 0 5px rgba(0, 180, 219, 0.5);
    }
}

/* Bounce effect when completed */
@keyframes bounce {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.1);
    }
}

/* Smooth transition effect for the bar color */
@keyframes gradientColorChange {
    0% {
        background-color: #00b4db;
    }
    100% {
        background-color: #0083b0;
    }
}


  body{
    overflow-x: hidden;
  }
  .form-control {
      font-size: 1rem;
      padding: -15px 20px;
  }
  label {
      font-size: 0.80rem;
  }
  .form-group {
      margin-bottom: 0;
  }

  .table td, .table th {
      padding: -5px;
  }

  .lab{
    top: 5px;
    /* color: #717477; */
    color: #818487;
  }

  .pdf-icon {
    width: 50px;
    height: 50px;
    margin-right: 10px;
    display: inline-block;
    background-image: url('../static/images/pdf.png');
    background-size: contain;
    background-repeat: no-repeat;
}

    .clearfix::after {
        content: "";
        clear: both;
        display: table;
    }
    .pull-left {
        float: left;
    }
    .pull-right {
        float: right;
    }
    .m-t-30 {
        margin-top: 30px;
    }
    .m-h-50 {
        margin-top: 50px;
    }
    .table {
        width: 100%;
        border-collapse: collapse;
    }
    .table th, .table td {
        border: 1px solid #dddddd;
        text-align: left;
        padding: 8px;
    }
    .table th {
        background-color: #f2f2f2;
    }
    .text-right {
        text-align: right;
    }
    .small {
        font-size: 14px;
    }
    .panel-body {
        margin-top: 20px;
    }
    .panel-body h3 {
        margin-bottom: 0;
    }
    .panel-body h4 {
        margin-top: 0;
        margin-bottom: 0;
    }
    .panel-body address {
        margin-bottom: 0;
    }

    .file-item {
    display: flex;
    align-items: center;
}

.file-item label {
    margin-right: 10px;
    flex-grow: 1;
}

.file-item input {
    margin-right: 10px;
    flex-shrink: 0;
}

.file-item button {
    flex-shrink: 0;
}


#uploaded-files-table td{
    overflow-x: hidden;
}

#uploaded-files-table thead th {
    text-align: center;
}

#uploaded-files-table {
    width: 100%;
}

#uploaded-files-table thead, #uploaded-files-table tbody {
    display: table;
    width: 100%;
    table-layout: fixed;
}

#uploaded-files-table thead th:nth-child(1), /* File Name column */
#uploaded-files-table tbody td:nth-child(1) {
    width: 37%; /* Increase File Name column width */
}



#uploaded-files-table thead th:nth-child(4), /* Page Count column */
#uploaded-files-table tbody td:nth-child(4) {
    width: 10%; /* Keep Page Count column width */
    
}

#uploaded-files-table thead th:nth-child(5), /* Action column */
#uploaded-files-table tbody td:nth-child(5) {
    width: 11%; /* Decrease Action column width */
}







 /* File Name column */
/* #uploaded-files-table tbody td:nth-child(1) {
    width: 84%; 
} */

 /* Page Count column */
/* #uploaded-files-table tbody td:nth-child(2) {
    width: 18%; 
} */

 /* Action column */
/* #uploaded-files-table tbody td:nth-child(3) {
    width: 10%; 
} */


#uploaded-files-table tbody {
    display: block;
    max-height: 100px; /* Adjusted to show only 2 rows initially */
    overflow-y: auto;
}

#uploaded-files-table tbody tr {
    display: table;
    width: 100%;
    table-layout: fixed;
}

#uploaded-files-table tbody::-webkit-scrollbar {
    width: 1px;
}

#uploaded-files-table tbody::-webkit-scrollbar-track {
    background: #f1f1f1;
}

#uploaded-files-table tbody::-webkit-scrollbar-thumb {
    background: #888;
}

#uploaded-files-table tbody::-webkit-scrollbar-thumb:hover {
    background: #555;
}

.fee-div {
        margin-top: 10px;
        margin-bottom: 10px;
    }




</style>

  </head>
  <!-- [Head] end -->
  <!-- [Body] Start -->

  <body data-pc-preset="preset-1" data-pc-sidebar-caption="true" data-pc-layout="vertical" data-pc-direction="ltr" data-pc-theme_contrast="" data-pc-theme="light">
    <!-- [ Pre-loader ] start -->
<div class="page-loader">
  <div class="bar"></div>
</div>
<!-- [ Pre-loader ] End -->
 <!-- [ Sidebar Menu ] start -->
<nav class="pc-sidebar">
  <div class="navbar-wrapper">
    <div class="m-header">
      <a href="/welcome/" class="b-brand text-primary">
        <!-- ========   Change your logo from here   ============ -->
        <img src="{% static 'images/claimbridge.png' %}" class="img-fluid" width="160px" alt="logo" />
        <span class="badge bg-light-success rounded-pill ms-2 theme-version"></span>
      </a>
    </div>
    <div class="navbar-content">
      <div class="card pc-user-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="flex-shrink-0">
              <img src="{% static 'images/user/avatar-1.jpg' %}" alt="user-image" class="user-avtar wid-45 rounded-circle" />
            </div>
            <div class="flex-grow-1 ms-3 me-2">
              <small>Hi</small>
              <h6 class="mb-0">{{ request.session.username }}</h6>
            </div>
            <a class="btn btn-icon btn-link-secondary avtar" data-bs-toggle="collapse" href="#pc_sidebar_userlink">
              <svg class="pc-icon">
                <use xlink:href="#custom-sort-outline"></use>
              </svg>
            </a>
          </div>
          <div class="collapse pc-user-links" id="pc_sidebar_userlink">
            <div class="pt-3">
              <a href="#!">
                <i class="ti ti-user"></i>
                <span>My Account</span>
              </a>
              <a href="#!">
                <i class="ti ti-settings"></i>
                <span>Settings</span>
              </a>
              <a href="#!">
                <i class="ti ti-lock"></i>
                <span>Lock Screen</span>
              </a>
              <a href="#!">
                <i class="ti ti-power"></i>
                <span>Logout</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <ul class="pc-navbar">
        <li class="pc-item pc-caption">
          <label></label>
        </li>
        <li class="pc-item">
          <a href="/welcome/" class="pc-link" data-toggle="tooltip" title="Dashboard">
            <span class="pc-micon">
              <svg class="pc-icon">
                <use xlink:href="#custom-story"></use>
              </svg>
            </span>
            <span class="pc-mtext"></span>
          </a>
        </li>


        <li class="pc-item pc-hasmenu">
          <a href="/registration/" class="pc-link" data-toggle="tooltip" title="Workflow">
            

            <span class="pc-micon">
                <svg class="pc-icon">
                  <use xlink:href="#custom-fatrows"></use>
                </svg>
              </span>
            <span class="pc-mtext"></span>
             
          </a>
  
        </li>

        <li class="pc-item pc-hasmenu">
          <a href="/analytics/" class="pc-link" data-toggle="tooltip" title="Analytics">
            <span class="pc-micon">
                <svg class="pc-icon">
                  <use xlink:href="#custom-status-up"></use>
                </svg>
              </span>
            <span class="pc-mtext"></span>
             </a>
   
        </li>

        {% if request.session.usertype == 'admin' %}
            <li class="pc-item pc-hasmenu">
              <a href="/pricing_page/" class="pc-link" data-toggle="tooltip" title="Charges">
                <span class="pc-micon">
                  <svg class="pc-icon">
                    <use xlink:href="#custom-dollar-square"></use>
                  </svg>
                </span>
                <span class="pc-mtext"></span>
               
              </a>
           
            </li>
            {% endif %}

        <li class="pc-item pc-hasmenu">
          <a href="/logout/" class="pc-link" data-toggle="tooltip" title="Logout">
            <span class="pc-micon">
                <svg class="pc-icon me-2">
                    <use xlink:href="#custom-logout-1-outline"></use>
                  </svg>
            </span>
            <span class="pc-mtext"></span>
           
          </a>
       
        </li>
  
   
  </ul>
  <div>
    <h6 style="position: absolute; bottom: 0;">  <span> Powered by Droidal</span><span><img src="{% static 'images/favicon1.png' %}" alt="img" style="height: 20px; margin-bottom: 3px; margin-left: 4px;"></span></h6> 
  </div>
</div>
</div>
</nav>

<div class="pc-header" style="backdrop-filter: blur(0px); background: none; width: 20px; position: absolute !important;">
  <div style="z-index: -111;">
  <li class="pc-h-item pc-sidebar-collapse">
    <a href="#" class="pc-head-link ms-0" id="sidebar-hide">
      <i class="ti ti-menu-2"></i>
    </a>
  </li>
  <li class="pc-h-item pc-sidebar-popup" style="z-index: -111;">
    <a href="#" class="pc-head-link ms-0" id="mobile-collapse">
      <i class="ti ti-menu-2"></i>
    </a>
  </li>
</div>
</div>



    <div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title" id="myModalLabel">File Upload</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" method="post" enctype="multipart/form-data"  action="{% url 'updatefilerecord' %}" >
                        {% csrf_token %}
                        <input type="hidden" id="queue_id" name="queue_id" />
                        <div class="form-group">
                            <label class="col-md-2 control-label">Upload</label>
                            <div class="col-md-10">
                                <input type="file" required  accept="application/JSON" id="form_upload" name="form_upload">
                            </div>
                        </div>
                          
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary waves-effect waves-light">Save changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
      <!-- [ Header ] end -->
      
      <div class="pc-container" style="top: -5px;">
        <div class="pc-content">
        



            <div class="content-page">
                <!-- Start content -->
                <div class="content">
                    <div class="container col-md-12">

 


                        <div class="card-box">  
                            <p style="position: absolute; top:10px; right: 10px; font-size: 16px; font-weight: 400;" id="request_id">Request Id : <strong>{{ data.request_id }}</strong></p>
                            
                            <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">

                                
                                <li class="nav-item">
                                    <a class="nav-link active" id="home-tab" data-bs-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Request</a>
                                </li>
                                <!-- <li class="nav-item">
                                    <a class="nav-link text-uppercase" id="profile-tab" data-bs-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">List</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link text-uppercase" id="contact-tab" data-bs-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Notes</a>
                                </li> 
                                <li class="nav-item">
                                    <a class="nav-link text-uppercase" id="material-tab" data-bs-toggle="tab" href="#material" role="tab" aria-controls="contact" aria-selected="false">Material</a>
                                </li>  -->
                                <li class="nav-item">
                                    <a class="nav-link" id="invoice-tab" data-bs-toggle="tab" href="#invoice" role="tab" aria-controls="profile" aria-selected="false">Response</a>
                                </li>
                                <!-- <li class="nav-item">
                                    <a class="nav-link text-uppercase" id="paymentscontents-tab" data-bs-toggle="tab" href="#paymentscontents" role="tab" aria-controls="contact" aria-selected="false">Payments</a>
                                </li> -->
                                <li class="nav-item">
                                    <a class="nav-link" id="documents-tab" data-bs-toggle="tab" href="#documents" role="tab" aria-controls="contact" aria-selected="false">Dispatch</a>
                                </li>
                            </ul>
                            <div class="tab-content" id="myTabContent">















                              <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                                <section>
                                  
                                    <div class="row">
                                        
                                        <div class="col-md-6">
                                            
                                            <div class="form-section">
                                                <!-- First Column -->

                                                <div class="row mb-3">
                                                  <label class="col-sm-3 col-form-label" for="request-date">Patient First Name</label>
                                                  <div class="col-sm-8">
                                                      <input type="text" class="form-control" id="request-date" value="{{data.patient_first_name}}" readonly>
                                                  </div>
                                              </div>

                                              <div class="row mb-3">
                                                <label class="col-sm-3 col-form-label" for="request-date">Patient Last Name</label>
                                                <div class="col-sm-8">
                                                    <input type="text" class="form-control" id="request-date" value="{{data.patient_last_name}}" readonly>
                                                </div>
                                            </div>
                                            <div class="row mb-3">
                                              <label class="col-sm-3 col-form-label" for="request-date">Patient DOB</label>
                                              <div class="col-sm-8">
                                                  <input type="text" class="form-control" id="request-date" value="{{data.patient_date_of_birth}}" readonly>
                                              </div>
                                          </div>
                                          <div class="row mb-3">
                                            <label class="col-sm-3 col-form-label" for="status">Status</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="status" value="{{data.ev_status}}" readonly>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <label class="col-sm-3 col-form-label" for="patient_no">Patient No</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" name="patient_no" id="patient_no" value="{{data.patient_no}}" placeholder="Enter The Patient No.">
                                            </div>
                                        </div>

                                        <div class="row mb-3">
                                            <label class="col-sm-3 col-form-label" for="address1">Address 1</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" name="address1" placeholder="Enter the Address 1 here" id="address1" value="{{data.address1}}" placeholder="Enter The Address">
                                            </div>
                                        </div>

                                        <div class="row mb-3">
                                            <label class="col-sm-3 col-form-label" for="city">City</label>
                                            <div class="col-sm-8">
                                                <input type="text" value="{{data.city}}" id="city" class="form-control" placeholder="Enter the City here">
                                            </div>
                                        </div>

                                        <div class="row mb-3">
                                            <label class="col-sm-3 col-form-label" for="zip_code">Zip Code</label>
                                            <div class="col-sm-8">
                                                <input type="text" value="{{data.zip_code}}" id="zip_code" class="form-control" placeholder="Enter the Zip Code here">
                                            </div>
                                        </div>
                                            </div>
                                        </div> 
                                        <div class="col-md-6">
                                            <div class="form-section">
                                                <!-- Second Column -->

                                                <div class="row mb-3">
                                                  <label class="col-sm-3 col-form-label" for="encounter">Request date</label>
                                                  <div class="col-sm-8">
                                                      <input type="text" class="form-control" id="encounter" value="{{data.request_date2}}" readonly>
                                                  </div>
                                              </div>
                                              <div class="row mb-3" style="margin-top: 40px;">
                                                <label class="col-sm-3 col-form-label" for="encounter">Requestor Name</label>
                                                <div class="col-sm-8">
                                                    <input type="text" class="form-control" id="encounter" value="{{data.requestor_name}}" readonly>
                                                </div>
                                            </div>
                                          
                                        
                                        <div class="row mb-3">
                                          <label class="col-sm-3 col-form-label" for="request-type">Request Type</label>
                                          <div class="col-sm-8">
                                              <input type="text" class="form-control" id="request-type" value="{{data.request_type}}" readonly>
                                          </div>
                                      </div>
                                      <div class="row mb-3">
                                        <label class="col-sm-3 col-form-label" for="email">Requestor Email</label>
                                        <div class="col-sm-8" id="email_request_id">
                                            <input type="text" class="form-control" id="email" value="{{data.requestor_email}}">
                                        </div>
                                    </div>
                                      <div class="row mb-3">
                                        <label class="col-sm-3 col-form-label" for="company">Company</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" id="company" placeholder="Enter the Company here" value="{{data.company}}">
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <label class="col-sm-3 col-form-label" for="address2">Address 2</label>
                                        <div class="col-sm-8">
                                            <input type="text" value="{{data.address2}}" placeholder="Enter the Address 2 here" id="address2" class="form-control">
                                        </div>
                                    </div>
                                      <div class="row mb-3">
                                        <label class="col-sm-3 col-form-label" for="notes">Notes</label>
                                        <div class="col-sm-8">
                                            <textarea name="notes" id="notes" style="width: 100%; height: 100px; border-color: #818487ce;" placeholder="Enter a Note Here">{{data.notes}}</textarea>
                                        </div>
                                    </div>
                                    
                                        </div> 
                                    </div>
                                    <div class="" style=" display: flex; justify-content: center; align-items: center;">
                                        <button class="btn btn-success" id="save-patient-data" style="width: 20%;">Save</button>
                                    </div>
                                
                                    </div>
                                </section>
                            </div>
                            
                            

                            
                            
                                <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                                    <section>
                                        <p>List Content</p>
                                    </section>
                                </div>
                                <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                                    <section>
                                        <p>Note Content</p>
                                    </section>
                                </div>
                                <div class="tab-pane fade" id="material" role="tabpanel" aria-labelledby="material-tab"> 
                                    <section>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="note">
                                                    <p>Note: You must 'SAVE' each row of information before you can add or change a row.</p>
                                                    <p>To Add a Document:</p>
                                                    <ol>
                                                        <li>Click the 'New Material' button</li>
                                                        <li>Enter the Starting and Ending dates</li>
                                                        <li>Select the document type (use the Pick List or type the code in the 'Code' column or type the description in the 'Desc' area)</li>
                                                        <li>Click the 'Save Material' button (or use the Toolbar 'save' icon)</li>
                                                    </ol>
                                                </div>
                                            </div>
                                            <div class="col-md-8">

                                                <div class="table-responsive">
                                                    <table class="table m-t-30">
                                                        <thead>
                                                            <tr><th>#</th>
                                                            <th>Doc Start</th>
                                                            <th>Doc End</th>
                                                            <th>Code</th>
                                                            <th>Description</th> 
                                                        </tr></thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>1</td>
                                                                <td>15-04-2024</td>
                                                                <td>17-04-2024</td>
                                                                <td>0001</td>
                                                                <td>Data 1</td>
                                                            </tr>
                                                            <tr>
                                                                <td>2</td>
                                                                <td>15-04-2024</td>
                                                                <td>17-04-2024</td>
                                                                <td>0002</td>
                                                                <td>Data 2</td>
                                                            </tr>
                                                            <tr>
                                                                <td>3</td>
                                                                <td>15-04-2024</td>
                                                                <td>17-04-2024</td>
                                                                <td>0003</td>
                                                                <td>Data 3</td>
                                                            </tr>
                                                            <tr>
                                                                <td>4</td>
                                                                <td>15-04-2024</td>
                                                                <td>17-04-2024</td>
                                                                <td>0004</td>
                                                                <td>Data 4</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                                </div>

















































                                
                                <div class="tab-pane fade" id="invoice" role="tabpanel" aria-labelledby="invoice-tab"> 
                                    <section> 

                                        <input type="hidden" id="request-id" value="{{data.request_id}}">
                                        <input type="hidden" id="total-pages" value="{{data.total_pages}}">
                                        <input type="hidden" id="total-amount" value="{{data.total_amount}}">
                                        <input type="hidden" id="balance" value="{{data.balance}}">

                                        
                                        
                                        <div class="row" style="border: .5px solid rgba(105, 103, 103, 0.308); padding: 10px;">
                                            <!-- First Row -->
                                            <div class="col-md-4">
                                                <div class="form-group row">
                                                    <label class="col-sm-4 col-form-label" for="patient_from_date">From Date</label>
                                                    <div class="col-sm-8 lab">
                                                        {{data.patient_from_date}}
                                                    </div>
                                                </div>
                                                
                                                
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group row">
                                                    <label class="col-sm-4 col-form-label" for="patient_to_date">To Date</label>
                                                    <div class="col-sm-8 lab">
                                                        {{data.patient_to_date}}
                                                    </div>
                                                </div>
                                                
                                                
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group row">
                                                    <label class="col-sm-4 col-form-label" for="status">Status</label>
                                                    <div class="col-sm-8 lab">
                                                        {{data.ev_status}}
                                                    </div>
                                                </div>
                                                <!-- <div class="form-group row">
                                                    <label class="col-sm-4 col-form-label" for="empl-bill">Empl Bill</label>
                                                    <div class="col-sm-8 lab">
                                                        <input type="text" value="kdsouthern" id="empl-bill" class="form-control">
                                                    </div>
                                                </div> -->
                                                
                                                <!-- <div class="form-group row">
                                                    <label class="col-sm-4 col-form-label" for="invoice-no">Invoice No</label>
                                                    <div class="col-sm-8">
                                                        <input type="text" id="invoice-no" class="form-control">
                                                    </div>
                                                </div> -->
                                            </div>
                                        </div>
                                        
                                    

<!-- Second Row: File Upload and Display -->
<div class="row mt-1">
    <!-- File Upload Column -->
    <div class="col-md-4" style="border: .5px solid rgba(105, 103, 103, 0.308); padding: 10px;">
        <h6 style="display: flex; justify-content: center; align-items: center; font-weight: 700; margin-bottom: 30px;">Select Files</h6>

        <div class="form-group row">
            <div class="col-sm-12" style="margin-top: 5px;">
                <input type="file" class="form-control" id="request_pdf" name="request_pdf" accept="application/pdf" multiple onchange="newHandleFileUpload(event)">
                <div id="new-loading" style="display:none; margin-top: 25px;">
                    <div id="line"></div> <!-- Make sure this div exists before initializing the progress bar -->
                    <div id="file-size-display" style="margin-top: 10px; color: #555; font-weight: bold;">
                        <!-- File size will be displayed here -->
                    </div>
                    
                </div>
            </div>
        </div>
        
    </div>
    
    <!-- Uploaded Files Column -->
    <div class="col-md-8" style="border: .5px solid rgba(105, 103, 103, 0.308); padding: 10px;">
        <h6 style="display: flex; justify-content: center; align-items: center; font-weight: 700; margin-bottom: 5px;">Uploaded Files</h6>

        <table class="table table-bordered" id="uploaded-files-table">
            <thead class="thead-light">
                <tr>
                    <th scope="col">File Name</th>
                    <th scope="col">From Date</th>
                    <th scope="col">To Date</th>
                    <th scope="col">Pages</th>
                    <th scope="col">Action</th>
                </tr>
            </thead>
            <tbody id="new-uploaded-files" style="display: block; max-height: 90px; overflow-y: auto;">
                <tr id="no-data">
                    <td colspan="3" class="text-center">NO DATA</td>
                </tr>
                <!-- Predefined rows for up to 10 files -->
                <tr id="file-row-1" style="display: none;">
                    <td id="file-name-1"></td>
                    <td><input type="date" id="file1_from_date" style="width: 88%; border: none;"></td>
                    <td><input type="date" id="file1_to_date" style="border: none;"></td>
                    <td id="file-pages-1"></td>
                    <td id="file-action-1"></td>
                </tr>
                <tr id="file-row-2" style="display: none;">
                    <td id="file-name-2"></td>
                    <td><input type="date" id="file2_from_date" style="width: 88%;border: none;"></td>
                    <td><input type="date" id="file2_to_date" style="border: none;"></td>
                    <td id="file-pages-2"></td>
                    <td id="file-action-2"></td>
                </tr>
                <tr id="file-row-3" style="display: none;">
                    <td id="file-name-3"></td>
                    <td><input type="date" id="file3_from_date" style="width: 88%;border: none;"></td>
                    <td><input type="date" id="file3_to_date" style="border: none;"></td>
                    <td id="file-pages-3"></td>
                    <td id="file-action-3"></td>
                </tr>
                <tr id="file-row-4" style="display: none;">
                    <td id="file-name-4"></td>
                    <td><input type="date" id="file4_from_date" style="width: 88%;border: none;"></td>
                    <td><input type="date" id="file4_to_date" style="border: none;"></td>
                    <td id="file-pages-4"></td>
                    <td id="file-action-4"></td>
                </tr>
                <tr id="file-row-5" style="display: none;">
                    <td id="file-name-5"></td>
                    <td><input type="date" id="file5_from_date" style="width: 88%;border: none;"></td>
                    <td><input type="date" id="file5_to_date" style="border: none;"></td>
                    <td id="file-pages-5"></td>
                    <td id="file-action-5"></td>
                </tr>
                <tr id="file-row-6" style="display: none;">
                    <td id="file-name-6"></td>
                    <td><input type="date" id="file6_from_date" style="width: 88%;border: none;"></td>
                    <td><input type="date" id="file6_to_date" style="border: none;"></td>
                    <td id="file-pages-6"></td>
                    <td id="file-action-6"></td>
                </tr>
                <tr id="file-row-7" style="display: none;">
                    <td id="file-name-7"></td>
                    <td><input type="date" id="file7_from_date" style="width: 88%;border: none;"></td>
                    <td><input type="date" id="file7_to_date" style="border: none;"></td>
                    <td id="file-pages-7"></td>
                    <td id="file-action-7"></td>
                </tr>
                <tr id="file-row-8" style="display: none;">
                    <td id="file-name-8"></td>
                    <td><input type="date" id="file8_from_date" style="width: 88%;border: none;"></td>
                    <td><input type="date" id="file8_to_date" style="border: none;"></td>
                    <td id="file-pages-8"></td>
                    <td id="file-action-8"></td>
                </tr>
                <tr id="file-row-9" style="display: none;">
                    <td id="file-name-9"></td>
                    <td><input type="date" id="file9_from_date" style="width: 88%;border: none;"></td>
                    <td><input type="date" id="file9_to_date" style="border: none;"></td>
                    <td id="file-pages-9"></td>
                    <td id="file-action-9"></td>
                </tr>
                <tr id="file-row-10" style="display: none;">
                    <td id="file-name-10"></td>
                    <td><input type="date" id="file10_from_date" style="width: 88%;border: none;"></td>
                    <td><input type="date" id="file10_to_date" style="border: none;"></td>
                    <td id="file-pages-10"></td>
                    <td id="file-action-10"></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>









<div class="row mt-1" style="border: .5px solid rgba(105, 103, 103, 0.308); padding: 10px;">
    <!-- First Column: Original HTML Provided -->
    <div class="col-md-4">
        <div class="form-column">
            <form id="chargeForm" action="javascript:void(0);">
                <div class="form-group">
                    <label for="state" class="col-sm-4 col-form-label">State</label>
                    <select name="" id="state" style="width: 60%; border: #ccc solid .5px; border-radius: 5px; color: #555;">
                        <option value="">--Select State--</option>
                        <option value="Alabama">Alabama</option>
                        <option value="Arkansas">Arkansas</option>
                        <option value="Colorado">Colorado</option>
                        <option value="Delaware">Delaware</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Indiana">Indiana</option>
                        <option value="New Jersey">New Jersey</option>
                        <option value="Kentucky">Kentucky</option>
                        <option value="Kansas">Kansas</option>
                        <option value="Louisiana">Louisiana</option>
                        <option value="Michigan">Michigan</option>
                        <option value="Missouri">Missouri</option>
                        <option value="Maryland">Maryland</option>
                        <option value="Mississippi">Mississippi</option>
                        <option value="North Carolina">North Carolina</option>
                        <option value="Ohio">Ohio</option>
                        <option value="Oklahoma">Oklahoma</option>
                        <option value="Oregon">Oregon</option>
                        <option value="Pennsylvania">Pennsylvania</option>
                        <option value="South Carolina">South Carolina</option>
                        <option value="Tennessee">Tennessee</option>
                        <option value="Texas">Texas</option>
                        <option value="Utah">Utah</option>
                        <option value="Virginia">Virginia</option>
                        <option value="Washington">Washington</option>
                        
                    </select>
                </div>
        
                <div class="form-group mt-3">
                    <label for="category" class="col-sm-4 col-form-label">Category</label>
                    <select name="" id="category" style="width: 60%; border: #ccc solid .5px; border-radius: 5px; color: #555;">
                        <option value="">--Select Category--</option>
                        <option value="general">General</option>
                        <option value="DDS">DDS</option>
                        <option value="workers compensation">Workers Compensation</option>
                        <option value="Patient">Patient</option>
                        <option value="Doctor's office">Doctor's office</option>
                        <option value="Non-billable other">Non-billable other</option>
                        <option value="Deposition">Deposition</option>
                    </select>
                </div>
        
            
                <div class="form-group mt-3" id="hours-group" style="display: none;">
                    <label for="hours" class="col-sm-4 col-form-label">Hours</label>
                    <input type="number" id="hours" name="hours" style="width: 60%; border: #ccc solid .5px; border-radius: 5px; color: #555;" min="1" value="1">
                </div>


                <div class="form-group mt-3" id="delivery-method-group" style="display: none;">
                    <label for="delivery-method" class="col-sm-6 col-form-label">Delivery Method</label>
                    <select id="delivery-method" style="width: 40%; border: #ccc solid .5px; border-radius: 5px; color: #555;">
                        <option value="">--Select Delivery Method--</option>
                        <option value="Mail">Mail</option>
                        <option value="Electronic">Electronic</option>
                    </select>
                </div>

                
                
            </form>
    
            
            <div class="mt-4" style="padding: 15px; background-color: #f1f1f1; border-left: 4px solid #007bff; border-radius: 5px; margin-left: 10px;">
                <h6 style="font-size: 1rem; color: #007bff; font-weight: bold; margin-bottom: 10px;">Calculation</h6>
                <div id="calculation-details" style="font-size: 0.9rem; color: #333;">
                    <!-- Calculation details will be injected here by JavaScript -->
                </div>
            </div>
            
        </div>
    </div>

    <!-- Second Column: Add Fee -->
<div class="col-md-4 text-center">
    <h6 style="font-weight: 700; margin-bottom: 30px;">Variable Fee</h6>
    <div class="text-center fee-container">
    <div class="fee-div fee_input">
        <select style="width: 40%; height: 35px; border: #ccc solid .5px; border-radius: 5px; color: #555;">
            <option value="Retrieval Fee">Retrieval Fee</option>
            <option value="Postage Fee">Postage Fee</option>
            <option value="Labor Fee">Labor fee</option>
            <option value="Cert Fee">Cert fee</option>
            <option value="Handling Fee">Handling Fee</option>
            <option value="Search Fee">Search Fee</option>
            <option value="Initial Fee">Initial Fee</option>
            <option value="Clerical Fee">Clerical Fee</option>
            <option value="Affidavit Fee">Affidavit Fee</option>
            <option value="Notary Fee">Notary Fee</option>
        </select>
        <input id="fee_input" type="text" style="width: 40%; height: 35px; border: #ccc solid .5px; border-radius: 5px; color: #555;">
        <i class="fa fa-plus" id="addFee" style="color: green; cursor: pointer;"></i>
    </div>
    </div>
    <!-- <button id="saveFees" style="margin-top: 15px; background-color: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
        Save <i class="fas fa-arrow-right"></i>
    </button> -->
    <div style="display: flex; align-items: center; margin-top: 20px;">
        <textarea name="optional_notes" id="optional-notes" placeholder="Enter Notes Here!" style="flex: 2; height: 100px; padding: 8px;"></textarea>
    </div>
    

    
</div>


    <!-- Third Column -->
    <div class="col-md-4">
        <div class="form-group row">
            <label class="col-sm-4 col-form-label" for="paper-copy-pages">Total Pages</label>
            <div class="col-sm-8 position-relative">
                <input type="text" id="paper-copy-pages" class="form-control" value="">
                <!-- <button type="button" id="save-pages" class="btn btn-primary">Save</button> -->
            </div>
        </div>
        
        
        <div class="form-group row mt-3">
            <!-- <label class="col-sm-4 col-form-label" for="total-paper-charge">Paper Charge</label> -->
            <div class="col-sm-8">
                <input type="hidden" id="total-paper-charge" name="total-paper-charge" class="form-control total_pages">
            </div>
        </div>
        <div class="form-group row mt-3">
            <!-- <label class="col-sm-4 col-form-label" for="total-additional-fees">Additional Charge</label> -->
            <div class="col-sm-8">
                <input type="hidden" id="total-additional-fees" class="form-control">
            </div>
        </div>
        <div class="form-group row mt-3 mb-5">
            <label class="col-sm-4 col-form-label" for="totalval">Total Amount</label>
            <div class="col-sm-8">
                <input type="text" id="totalval" class="form-control">
            </div>
        </div>
        <div class="col-md-12 mt-4 text-right">
            <button class="btn btn-success" style="width: 8rem;" onclick="generateInvoice()">Submit</button>
            <button class="btn btn-primary" onclick="viewInvoice()">
                <i class="fas fa-eye" style="font-size: 15px; margin: 3px 5px 0 0;"></i>View
            </button>
            <button class="btn btn-secondary" onclick="printInvoice()">
                <i class="fas fa-print" style="font-size: 15px; margin: 3px 5px 0 0;"></i>Print
            </button>
        </div>
    </div>
</div>

    
    </section>
    </div>
                                
                                


                              

































                              <div class="tab-pane fade" id="paymentscontents" role="tabpanel" aria-labelledby="paymentscontents-tab">
                                <section>
                                    <input type="hidden" id="total-pages" value="0">
                                    <input type="hidden" id="total-amount" value="0.00">
                                    <input type="hidden" id="balance" value="0.00">
                                    <div id="paymentcontentprint"></div>
                                    <div class="row">
                                      <div class="col-md-4">
                                          <div class="form-group row">
                                              <label class="col-sm-5 col-form-label" for="company">Total Amount</label>
                                              <div class="col-sm-7">
                                                  <input type="text" id="paymenttotalamount" value="0" class="form-control" readonly>
                                              </div>
                                          </div>
                                      </div>
                                      <div class="col-md-4">
                                          <div class="form-group row">
                                              <label class="col-sm-5 col-form-label" for="company">Payment Amount</label>
                                              <div class="col-sm-7">
                                                  <input type="text" id="paymentamount" value="0" class="form-control">
                                              </div>
                                          </div>
                                      </div>
                                      <div class="col-md-4 text-right">
                                          <button class="btn btn-primary" onclick="paymentsave()">Save</button>
                                      </div>
                                  </div>
                                </section>
                            </div>
                            
                            <div class="panel-body" style="display: none;" id="printbodycontent">
                                <div class="clearfix">
                                    <div class="pull-left">
                                        <h3>Upstream</h3>
                                        <p>
                                            BenchMark <br>
                                            Dept #888093 <br>
                                            Knoxville, TN 37995<br>
                                            ( 844 ) 319-6137<br>
                                            Tax id :  20-1530754<br>
                                        </p>
                                    </div>
                                    <div class="pull-right">
                                        <h4>Invoice<br>
                                            <strong>{{data.invoice_number}}</strong>
                                        </h4>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="pull-left m-t-30">
                                            <address>
                                                <strong>{{data.company}}</strong><br>
                                                {{data.address1}}<br>
                                                {{data.address2}}<br>
                                                {{data.city}}<br>
                                                {{data.zip_code}}<br>

                                                <!-- <abbr title="Phone">Ph:</abbr> {{data.phone}} -->
                                            </address>
                                        </div>
                                        <div class="pull-right m-t-30">
                                            <p><strong>Patient Name:</strong> {{data.patient_first_name}} {{data.patient_last_name}}</p>
                                            {% if data.patient_no %}
                                                <p><strong>Patient No:</strong> {{ data.patient_no }}</p>
                                            {% endif %}

                                            <p><strong>Order Date:</strong> 
                                                {{ data.external_request_createddatetime|slice:"8:10" }}/{{ data.external_request_createddatetime|slice:"5:7" }}/{{ data.external_request_createddatetime|slice:"0:4" }}
                                            </p>
                                            

                                            <p><strong>Order Completed Date:</strong> {% now "d/m/Y" %}</p>
                                            <!-- <p><strong>Order Status:</strong> <span class="label">Completed</span></p> -->
                                            <p><strong>Order ID:</strong> {{data.request_id}}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="m-h-50"></div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="table-responsive">
                                            <table class="table m-t-30">
                                                <thead>
                                                    <tr>
                                                        <th>#</th>
                                                        <th>Item</th>
                                                        <th>File Name</th>
                                                        <th>From Date</th>
                                                        <th>To Date</th>
                                                        <th class="text-end">Quantity</th>
                                                        <th class="text-end">Total Amount</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="invoice-tbody">
                                                    <!-- This will be dynamically populated -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 col-sm-6 col-xs-6">
                                        <div class="clearfix m-t-40">
                                            <h5 class="small text-inverse font-600">NOTE</h5>
                                            <small id="note-section">
                                                
                                            </small>
                                            <h5 class="small text-inverse font-600">BILLING INFORMATION</h5>
                                            <small>
                                                Please address all checks to BenchMark Physical Therapy and mail them to Dept #888093 Knoxville, TN37995. Please note that this is a lock box and not a street address. For card payment, please call 844-319-6137
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-sm-6 col-xs-6 col-md-offset-3">
                                        <div class="text-right" id="invoice-tbody"></div>
                                        <div class="text-right" id="inv-summary"></div>
                                        


                                        <hr>
                                        <h3 class="text-right" id="inv-total">USD 0</h3>

                                    </div>
                                </div>
                                <hr>
                            </div>
                            
                            









                                <div class="tab-pane fade" id="documents" role="tabpanel" aria-labelledby="documents-tab">
                                  <section>
                                      <div class="row" id="pdfcontents"></div>
                                      
                                      <div class="row m-t-30">
                                          <div class="row" style="margin-top: 2%;">
                                              <label class="col-sm-2" for="company" style="font-size: 15px; font-weight: 700">To Address</label> 
                                              <input type="text" class="text-center" id="toaddress" value="{{data.requestor_email}}" style="width: 30%; border-radius: 5px;" readonly> 
                                          </div>
                                          <div class="row" style="margin-top: 2%;">
                                            <label class="col-sm-2" for="company" style="font-size: 15px; font-weight: 700">CC</label> 
                                            <input type="text" class="text-center" id="cc" placeholder="Enter 'CC' with Comma(,) Seperated" name="cc" style="width: 30%; border-radius: 5px;"> 
                                        </div>
                                        <div class="row" style="margin-top: 2%;">
                                          <label class="col-sm-2" for="company" style="font-size: 15px; font-weight: 700">Bcc</label> 
                                          <input type="text" class="text-center" id="bcc" placeholder="Enter 'BCC' with Comma(,) Seperated" name="bcc" style="width: 30%; border-radius: 5px;"> 
                                      </div>
                                          <div class="row" style="margin-top: 2%;">
                                              <label class="col-sm-2" for="company" style="font-size: 15px; font-weight: 700">Subject</label> 
                                              <textarea type="text" class="text-center" id="tosubject" rows="3" cols="50" style="width: 30%; border-radius: 5px;">Patient Documents and Invoice Attached</textarea> 
                                          </div>
                                          <div class="row" style="margin-top: 2%;">
                                              <label class="col-sm-4" for="company" style="font-size: 15px; font-weight: 700">Message Content</label> 
                                              <textarea type="text" id="tomsgcontent" rows="8" cols="50" style="border-radius: 5px;">Dear {{data.requestor_name}} ,&#13;&#10;We are pleased to inform you that your requested medical records have been processed and are attached via link(s) to this email.&#13;&#10;The invoice is attached Seperately. Please see details on invoice for payment instructions. If you have any further questions or need additional assistance, please feel free to contact our office at <b>( 844 ) 319-6137</b> or via email at <b>roi@urpt.com.</b>.&#13;&#10;Thank you for your patience.&#13;&#10;Best regards,&#13;&#10;Upstream</textarea> 
                                          </div>
                                          <div class="col-md-12">
                                              <button class="btn btn-sm btn-primary" style="margin-top: 1%; float: right;" onclick="sendDocuments()">Send Documents</button>
                                          </div>
                                      </div>
                                  </section>
                              </div>
                              
                              
                              
                            </div>

                        </div>
                        <!-- end row -->

 
                    </div> <!-- container -->

                </div> <!-- content -->

            </div>
    </div>
  </div>

<!-- [ accordion-collapse ] end -->
    
<!-- <div class="row">
  <div class="col-md-11 d-flex justify-content-end mt-5" style="margin-left:50px">
    <button class="btn btn-primary" style="width: 150px;" type="submit">Save</button>
  </div>
</div> -->
</form>

<!-- [ Main Content ] start -->
           
           
<div class="pct-c-btn" style="display: none;">
    <a href="#" data-bs-toggle="offcanvas" data-bs-target="#offcanvas_pc_layout">
      <i class="ph-duotone ph-gear-six"></i>
    </a>
  </div>
<div class="offcanvas border-0 pct-offcanvas offcanvas-end" tabindex="-1" id="offcanvas_pc_layout">
<div class="offcanvas-header">
  <h5 class="offcanvas-title">Settings</h5>
  <button type="button" class="btn btn-icon btn-link-danger ms-auto" data-bs-dismiss="offcanvas" aria-label="Close"
    ><i class="ti ti-x"></i
  ></button>
</div>
<div class="pct-body customizer-body">
  <div class="offcanvas-body py-0">
    <ul class="list-group list-group-flush">
      <li class="list-group-item">
        <div class="pc-dark">
          <h6 class="mb-1">Theme Mode</h6>
          <p class="text-muted text-sm">Choose light or dark mode or Auto</p>
          <div class="row theme-color theme-layout">
            <div class="col-4">
              <div class="d-grid">
                <button
                  class="preset-btn btn active"
                  data-value="true"
                  onclick="layout_change('light');"
                  data-bs-toggle="tooltip"
                  title="Light"
                >
                  <svg class="pc-icon text-warning">
                    <use xlink:href="#custom-sun-1"></use>
                  </svg>
                </button>
              </div>
            </div>
            <div class="col-4">
              <div class="d-grid">
                <button class="preset-btn btn" data-value="false" onclick="layout_change('dark');" data-bs-toggle="tooltip" title="Dark">
                  <svg class="pc-icon">
                    <use xlink:href="#custom-moon"></use>
                  </svg>
                </button>
              </div>
            </div>
            <div class="col-4">
              <div class="d-grid">
                <button
                  class="preset-btn btn"
                  data-value="default"
                  onclick="layout_change_default();"
                  data-bs-toggle="tooltip"
                  title="Automatically sets the theme based on user's operating system's color scheme."
                >
                  <span class="pc-lay-icon d-flex align-items-center justify-content-center">
                    <i class="ph-duotone ph-cpu"></i>
                  </span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </li>
      <li class="list-group-item">
        <h6 class="mb-1">Theme Contrast</h6>
        <p class="text-muted text-sm">Choose theme contrast</p>
        <div class="row theme-contrast">
          <div class="col-6">
            <div class="d-grid">
              <button
                class="preset-btn btn"
                data-value="true"
                onclick="layout_theme_contrast_change('true');"
                data-bs-toggle="tooltip"
                title="True"
              >
                <svg class="pc-icon">
                  <use xlink:href="#custom-mask"></use>
                </svg>
              </button>
            </div>
          </div>
          <div class="col-6">
            <div class="d-grid">
              <button
                class="preset-btn btn active"
                data-value="false"
                onclick="layout_theme_contrast_change('false');"
                data-bs-toggle="tooltip"
                title="False"
              >
                <svg class="pc-icon">
                  <use xlink:href="#custom-mask-1-outline"></use>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </li>
      <li class="list-group-item">
        <h6 class="mb-1">Custom Theme</h6>
        <p class="text-muted text-sm">Choose your primary theme color</p>
        <div class="theme-color preset-color">
          <a href="#!" data-bs-toggle="tooltip" title="Blue" class="active" data-value="preset-1"><i class="ti ti-checks"></i></a>
          <a href="#!" data-bs-toggle="tooltip" title="Indigo" data-value="preset-2"><i class="ti ti-checks"></i></a>
          <a href="#!" data-bs-toggle="tooltip" title="Purple" data-value="preset-3"><i class="ti ti-checks"></i></a>
          <a href="#!" data-bs-toggle="tooltip" title="Pink" data-value="preset-4"><i class="ti ti-checks"></i></a>
          <a href="#!" data-bs-toggle="tooltip" title="Red" data-value="preset-5"><i class="ti ti-checks"></i></a>
          <a href="#!" data-bs-toggle="tooltip" title="Orange" data-value="preset-6"><i class="ti ti-checks"></i></a>
          <a href="#!" data-bs-toggle="tooltip" title="Yellow" data-value="preset-7"><i class="ti ti-checks"></i></a>
          <a href="#!" data-bs-toggle="tooltip" title="Green" data-value="preset-8"><i class="ti ti-checks"></i></a>
          <a href="#!" data-bs-toggle="tooltip" title="Teal" data-value="preset-9"><i class="ti ti-checks"></i></a>
          <a href="#!" data-bs-toggle="tooltip" title="Cyan" data-value="preset-10"><i class="ti ti-checks"></i></a>
        </div>
      </li>
      <li class="list-group-item">
        <h6 class="mb-1">Theme layout</h6>
        <p class="text-muted text-sm">Choose your layout</p>
        <div class="theme-main-layout d-flex align-center gap-1 w-100">
          
          <a href="#!" data-bs-toggle="tooltip" title="Horizontal" data-value="horizontal">
            <img src="{% static 'images/customizer/horizontal.svg' %}" alt="img" class="img-fluid" />
          </a>
          <a href="#!" data-bs-toggle="tooltip" title="Color Header" data-value="color-header">
            <img src="{% static 'images/customizer/color-header.svg' %}" alt="img" class="img-fluid" />
          </a>
          <!-- <a href="#!" data-bs-toggle="tooltip" title="Compact" data-value="compact">
            <img src="..//images/customizer/compact.svg" alt="img" class="img-fluid" /> 
          </a> -->
          <a href="#!" data-bs-toggle="tooltip" title="Tab" data-value="tab">
            <img src="{% static 'images/customizer/tab.svg' %}" alt="img" class="img-fluid" />
          </a>
        </div>
      </li>
      <li class="list-group-item">
        <h6 class="mb-1">Sidebar Caption</h6>
        <p class="text-muted text-sm">Sidebar Caption Hide/Show</p>
        <div class="row theme-color theme-nav-caption">
          <div class="col-6">
            <div class="d-grid">
              <button
                class="preset-btn btn-img btn active"
                data-value="true"
                onclick="layout_caption_change('true');"
                data-bs-toggle="tooltip"
                title="Caption Show"
              >
                <img src="{% static 'images/customizer/caption-on.svg' %}" alt="img" class="img-fluid" />
              </button>
            </div>
          </div>
          <div class="col-6">
            <div class="d-grid">
              <button
                class="preset-btn btn-img btn"
                data-value="false"
                onclick="layout_caption_change('false');"
                data-bs-toggle="tooltip"
                title="Caption Hide"
              >
                <img src="{% static 'images/customizer/caption-off.svg' %}" alt="img" class="img-fluid" />
              </button>
            </div>
          </div>
        </div>
      </li>
      <li class="list-group-item">
        <div class="pc-rtl">
          <h6 class="mb-1">Theme Layout</h6>
          <p class="text-muted text-sm">LTR/RTL</p>
          <div class="row theme-color theme-direction">
            <div class="col-6">
              <div class="d-grid">
                <button
                  class="preset-btn btn-img btn active"
                  data-value="false"
                  onclick="layout_rtl_change('false');"
                  data-bs-toggle="tooltip"
                  title="LTR"
                >
                  <img src="{% static 'images/customizer/ltr.svg' %}" alt="img" class="img-fluid" />
                </button>
              </div>
            </div>
            <div class="col-6">
              <div class="d-grid">
                <button
                  class="preset-btn btn-img btn"
                  data-value="true"
                  onclick="layout_rtl_change('true');"
                  data-bs-toggle="tooltip"
                  title="RTL"
                >
                  <img src="{% static 'images/customizer/rtl.svg' %}" alt="img" class="img-fluid" />
                </button>
              </div>
            </div>
          </div>
        </div>
      </li>
      <li class="list-group-item pc-box-width">
        <div class="pc-container-width">
          <h6 class="mb-1">Layout Width</h6>
          <p class="text-muted text-sm">Choose Full or Container Layout</p>
          <div class="row theme-color theme-container">
            <div class="col-6">
              <div class="d-grid">
                <button
                  class="preset-btn btn-img btn active"
                  data-value="false"
                  onclick="change_box_container('false')"
                  data-bs-toggle="tooltip"
                  title="Full Width"
                >
                  <img src="{% static 'images/customizer/full.svg' %}" alt="img" class="img-fluid" />
                </button>
              </div>
            </div>
            <div class="col-6">
              <div class="d-grid">
                <button
                  class="preset-btn btn-img btn"
                  data-value="true"
                  onclick="change_box_container('true')"
                  data-bs-toggle="tooltip"
                  title="Fixed Width"
                >
                  <img src="{% static 'images/customizer/fixed.svg' %}" alt="img" class="img-fluid" />
                </button>
              </div>
            </div>
          </div>
        </div>
      </li>
      <li class="list-group-item">
        <div class="d-grid">
          <button class="btn btn-light-danger" id="layoutreset">Reset Layout</button>
        </div>
      </li>
    </ul>
  </div>
</div>
</div>


<script>
localStorage.setItem('layout', 'compact');
</script>
  <!-- [Page Specific JS] start -->
  <script src="{% static 'js/layout-compact.js' %}"></script>







            
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <!-- Bootstrap JS and dependencies -->
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        
                        <!-- Bootstrap JS and dependencies -->
                        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
                        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
                    


                        <!-- End row -->
 

                                </div> 
 
                        </div>
                        <!-- end row -->

 
                    </div> <!-- container -->

                </div> <!-- content -->
                
                  
                      <!-- [Page Specific JS] start -->
                      <!-- <script src="{% static 'js/plugins/apexcharts.min.js' %}"></script> -->
                      <!-- <script src="{% static 'js/pages/dashboard-default.js' %}"></script> -->
                      <!-- [Page Specific JS] end -->
                      <!-- Required Js -->
                      <!-- <script src="{% static 'js/plugins/popper.min.js' %}"></script> -->
                      <script src="{% static 'js/plugins/simplebar.min.js' %}"></script>
                      <script src="{% static 'js/plugins/bootstrap.min.js' %}"></script>
                      <script src="{% static 'js/fonts/custom-font.js' %}"></script>
                      <script src="{% static 'js/pcoded.js' %}"></script>
                      <script src="{% static 'js/plugins/feather.min.js' %}"></script>

                                    <!-- Include jQuery -->
                        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                        <!-- Include Popper.js -->
                        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
                        <!-- Include Bootstrap JS -->
                        <!-- Include DataTables JS -->
                        <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
                      
                      <script>
                        // layout_change('light');
                      </script>
                        
                      <script>
                        // change_box_container('false');
                      </script>
                       
                      <script>
                        // layout_caption_change('true');
                      </script>
                       
                      <script>
                        // layout_rtl_change('false');
                      </script>
                       
                      <script>
                        // preset_change('preset-1');
                      </script>
                       
                      <script>
                        // main_layout_change('vertical');
                      </script>
                      
                  
                    </body>
                    <!-- [Body] end -->
                  </html>
                  


        <script type="text/javascript">
			
        </script>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
const pdfIconPath = "{% static 'images/pdf.png' %}";
let currentSessionFiles = [];
let newSessionFiles = [];
let progressBar;
let generatedPdfPath = '';

document.addEventListener('DOMContentLoaded', function () {
    // Check if the container for the progress bar exists
    const progressBarContainer = document.getElementById('line');
    if (progressBarContainer) {
        // Initialize the progress bar
        progressBar = new ProgressBar.Line(progressBarContainer, {
            strokeWidth: 2,
            easing: 'easeInOut',
            duration: 2000,
            color: '#2E6CD8',
            trailColor: '#eee',
            trailWidth: 1,
            svgStyle: { width: '100%', height: '100%' },
            text: {
                style: {
                    color: '#999',
                    position: 'absolute',
                    left: '10px',
                    top: '40px',
                    padding: 0,
                    margin: 0,
                    transform: null
                },
                autoStyleContainer: false
            },
            from: { color: '#FFEA82' },
            to: { color: '#ED6A5A' },
            step: (state, bar) => {
                bar.setText(Math.round(bar.value() * 100) + ' %');
            }
        });
    } else {
        console.error('Progress bar container does not exist!');
    }

    // Fetch existing files from the server
    fetchExistingFiles();
});

// function updateDocumentsTab() {
//     const pdfContentsDiv = document.getElementById('pdfcontents');
//     pdfContentsDiv.innerHTML = ''; // Clear the div first

//     newSessionFiles.forEach((fileUrl, index) => {
//         const pdfDiv = document.createElement('div');
//         pdfDiv.className = 'col-md-3';
//         pdfDiv.innerHTML = `<img src="${pdfIconPath}" alt="PDF Icon" style="width: 20px; height: 20px; margin-right: 5px;"><a href="${fileUrl}" target="_blank">${fileUrl.split('/').pop()}</a>`;
//         pdfContentsDiv.appendChild(pdfDiv);
//     });
// }

// // Update documents tab when the tab is clicked
// document.getElementById('documents-tab').addEventListener('click', function () {
//     updateDocumentsTab();
// });



// Fetch existing files from the server
function fetchExistingFiles() {
    const requestId = document.getElementById('request-id').value;

    fetch(`/get_existing_files/${requestId}/`, {
        method: 'GET',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        const noDataRow = document.getElementById('no-data');
        const pdfContentsDiv = document.getElementById('pdfcontents');
        pdfContentsDiv.innerHTML = ''; // Clear the div first

        if (data.files && data.files.length > 0) {
            noDataRow.style.display = 'none'; // Hide "NO DATA" row
            data.files.forEach((file, index) => {
                newDisplayUploadedPDF(index + 1, file.url, file.pages);
                newSessionFiles.push(file.url);
                updateTotalPagesAndAmount(); // Update total pages after adding each file
            });
        } else {
            noDataRow.style.display = ''; // Show "NO DATA" row if no files
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

let totalPagesEdited = false;  // Track if total pages are edited

// Add event listener for the "Save" button
// document.getElementById('save-pages').addEventListener('click', function() {
//     if (!totalPagesEdited) {
//         alert('No changes made to total pages.');
//         return;
//     }

//     // Send the updated total_pages to the backend
//     const updatedValue = document.getElementById('paper-copy-pages').value;  // Get the new value entered by the user
//     const requestId = document.getElementById('request-id').value;  // Assuming there's an element with id="request-id"

//     if (!updatedValue || isNaN(updatedValue)) {
//         alert('Please enter a valid number of pages.');
//         return;
//     }

//     // Create FormData to send via AJAX
//     const formData = new FormData();
//     formData.append('total_pages', updatedValue);
//     formData.append('requestid', requestId);

//     // Create an AJAX request to send the updated value to the backend
//     const xhr = new XMLHttpRequest();
//     xhr.open('POST', '/update_total_pages/', true);

//     // Set CSRF token header (Django uses CSRF tokens to secure POST requests)
//     xhr.setRequestHeader('X-CSRFToken', document.querySelector('[name=csrfmiddlewaretoken]').value);

//     // Handle the response from the server
//     xhr.onload = function() {
//         if (xhr.status === 200) {
//             const response = JSON.parse(xhr.responseText);
//             if (response.status === 'success') {
//                 console.log('Total pages updated successfully:', response.total_pages);
//                 alert('Total pages updated successfully.');
//                 totalPagesEdited = false;  // Reset the flag after successful save
//             } else {
//                 console.error('Error updating total pages:', response.message);
//                 alert('Error updating total pages.');
//             }
//         } else {
//             console.error('Error during the request:', xhr.statusText);
//             alert('An error occurred while updating the total pages.');
//         }
//     };

//     // Handle any errors during the request
//     xhr.onerror = function () {
//         console.error('Error during the request.');
//         alert('An error occurred while updating the total pages.');
//     };

//     // Send the request
//     xhr.send(formData);
// });

// Add event listener for when the user finishes editing and changes the value
document.getElementById('paper-copy-pages').addEventListener('change', function() {
    totalPagesEdited = true;  // Set the flag to true when an edit occurs
});

// Function to handle file upload and update total pages
function newHandleFileUpload(event) {
    const fileInput = event.target;
    const files = fileInput.files;

    if (files.length === 0) {
        document.getElementById('new-loading').style.display = 'none';
        progressBar.set(0); // Reset progress bar
        return;
    }

    // Limit the number of uploaded files to 10
    if (newSessionFiles.length + files.length > 10) {
        alert('You can upload a maximum of 10 files.');
        return;
    }

    document.getElementById('new-loading').style.display = 'block';  // Show loading bar

    let totalFiles = files.length;
    let filesProcessed = 0;
    progressBar.set(0); // Reset the progress bar
    let totalPages = 0;  // Initialize total pages count

    // Continue with file upload process
    Array.from(files).forEach((file, index) => {
        const formData = new FormData();
        formData.append('miscfiles', file);
        const requestId = document.getElementById('request-id').value;
        formData.append('requestid', requestId);
        const file_from_date = document.getElementById('request-id').value;

        const xhr = new XMLHttpRequest();
        xhr.open('POST', '/handle_file_upload/', true);

        // Set CSRF token header
        xhr.setRequestHeader('X-CSRFToken', document.querySelector('[name=csrfmiddlewaretoken]').value);

        // Monitor upload progress and display file size
        xhr.upload.onprogress = function (event) {
            if (event.lengthComputable) {
                const percentComplete = (event.loaded / event.total) * 100;
                progressBar.set(percentComplete / 100); // Update the progress bar
                
                // Display file size uploaded in KB/MB
                const uploadedSize = (event.loaded / 1024).toFixed(2); // Convert to KB
                const totalSize = (event.total / 1024).toFixed(2); // Convert to KB
                
                const sizeDisplay = `${uploadedSize} KB of ${totalSize} KB`;
                document.getElementById('file-size-display').innerText = sizeDisplay;
            }
        };

        // When upload is done
        xhr.onload = function () {
            if (xhr.status === 200) {
                const data = JSON.parse(xhr.responseText);
                filesProcessed++;
                progressBar.set(filesProcessed / totalFiles);  // Update progress after each file

                if (filesProcessed === totalFiles) {
                    document.getElementById('new-loading').style.display = 'none';  // Hide loading icon
                }

                const noDataRow = document.getElementById('no-data');
                noDataRow.style.display = 'none'; // Hide "NO DATA" row

                // Display the newly uploaded file
                newDisplayUploadedPDF(newSessionFiles.length + 1, data.file_url, data.num_pages);
                newSessionFiles.push(data.file_url);

                // Update total pages dynamically by adding pages of each file
                addNewFilePages(parseInt(data.num_pages, 10));
            } else {
                console.error('Error during file upload:', xhr.statusText);
            }
        };

        // Handle upload errors
        xhr.onerror = function () {
            console.error('Error during file upload:', xhr.statusText);
        };

        // Send the form data
        xhr.send(formData);
    });

    // Clear the file input
    $("#request_pdf").val("");
}



// Animate the progress bar for smooth loading effect
// function animateProgressBar() {
//     let start = null;
//     const duration = 2000;
//     const animate = timestamp => {
//         if (!start) start = timestamp;
//         const progress = Math.min((timestamp - start) / duration, 1);
//         progressBar.set(progress);
//         if (progress < 1) {
//             requestAnimationFrame(animate);
//         }
//     };
//     requestAnimationFrame(animate);
// }


function newDisplayUploadedPDF(rowId, fileUrl, numPages) {
    const fileRow = document.getElementById(`file-row-${rowId}`);
    const fileNameCell = document.getElementById(`file-name-${rowId}`);
    const filePagesCell = document.getElementById(`file-pages-${rowId}`);
    const fileActionCell = document.getElementById(`file-action-${rowId}`);

    const fileName = decodeURIComponent(fileUrl.split('/').pop());

    fileNameCell.innerHTML = `<a href="${fileUrl}" target="_blank">${fileName}</a>`;
    filePagesCell.innerText = `${numPages}`;
    fileActionCell.innerHTML = `<button type="button" class="btn btn-danger btn-sm" onclick="newDeleteFile('${fileUrl}', ${rowId})"><i class="fa fa-trash"></i></button>`;

    fileRow.style.display = '';

    // Add to the pdfcontents div if not already present
    const pdfContentsDiv = document.getElementById('pdfcontents');

    // Decode the file name
    const pdffileName = decodeURIComponent(fileUrl.split('/').pop());

    // Check if the PDF div already exists
    const existingPdfDiv = Array.from(pdfContentsDiv.children).find(div => div.innerText.includes(pdffileName));

    if (!existingPdfDiv) {
        // Create a new PDF div with decoded file name
        const pdfDiv = document.createElement('div');
        pdfDiv.className = 'col-md-3';
        pdfDiv.innerHTML = `
            <img src="${pdfIconPath}" alt="PDF Icon" style="width: 20px; height: 20px; margin-right: 5px;">
            <a href="${fileUrl}" target="_blank">${pdffileName}</a>`;
        pdfContentsDiv.appendChild(pdfDiv);
    }


}



function newDeleteFile(fileUrl, rowId) {
    const requestId = document.getElementById('request-id').value;
    const formData = new FormData();
    formData.append('file_url', fileUrl);
    formData.append('requestid', requestId);

    fetch('/delete_file/', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const fileRow = document.getElementById(`file-row-${rowId}`);
            if (fileRow) {
                fileRow.style.display = 'none';
                fileRow.querySelector(`#file-name-${rowId}`).innerHTML = '';
                fileRow.querySelector(`#file-pages-${rowId}`).innerHTML = '';
                fileRow.querySelector(`#file-action-${rowId}`).innerHTML = '';
            }

            // Remove the file from the newSessionFiles array
            newSessionFiles = newSessionFiles.filter(file => file !== fileUrl);

            if (newSessionFiles.length === 0) {
                document.getElementById('no-data').style.display = '';
            }

            // Decode the file name for removal
            const fileName = decodeURIComponent(fileUrl.split('/').pop());

            // Remove the corresponding div from the pdfcontents div
            const pdfContentsDiv = document.getElementById('pdfcontents');
            const pdfDivToRemove = Array.from(pdfContentsDiv.children).find(div => div.innerText.includes(fileName));
            if (pdfDivToRemove) {
                pdfContentsDiv.removeChild(pdfDivToRemove);
            }

            // Update total pages and amount
            updateTotalPagesAndAmount();
        } else {
            alert('Failed to delete file.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}





















  function handleFileChange(event, miscId, pageId) {
    const fileInput = event.target;
    const formData = new FormData();
    formData.append('miscfiles', fileInput.files[0]);
    formData.append('miscname', miscId);
    const requestId = document.getElementById('request-id').value;
    formData.append('requestid', requestId);

    fetch('/calculatepdfpage/', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById(pageId).value = data.num_pages;
        document.getElementById('total-pages').value = data.total_pages; 
        document.getElementById('totalval').value = data.total_amount.toFixed(2); 
        document.getElementById('balance').value = data.total_amount.toFixed(2); 
        updateOverallPageCountAndPrice();
        console.log("handleFileChange")
        updateInvoiceTable();
        displayUploadedPDF(fileInput.files[0], miscId);
        currentSessionFiles.push(fileInput.files[0]);
        addFileLinkToMessage(fileInput.files[0], data.num_pages);
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

// function addFileLinkToMessage(file, numPages) {
//     const messageContent = document.getElementById('tomsgcontent');
//     const fileUrl = `/media/tempfiles/${file.name}`;
//     const fileLink = `<a href="${fileUrl}" target="_blank">LINK</a> (${numPages} pages)`;
//     messageContent.value += `\n${fileLink}`;
// }



// function updatePaymentTab() {
//     const htmlContent = document.getElementById('printbodycontent').innerHTML;
//     document.getElementById('paymentcontentprint').innerHTML = htmlContent;
//     updateTotalAmount();
// }
  
// function displayUploadedPDF(file, miscPathId) {
//     const pdfContentsDiv = document.getElementById('pdfcontents');
//     const pdfIcon = `<img src="${pdfIconPath}" alt="PDF Icon" style="width: 50px; height: 50px;">`;
//     const fileLink = `<a href="#" onclick="openPDF('${URL.createObjectURL(file)}')">${file.name}</a>`;
    
//     const pdfDiv = document.createElement('div');
//     pdfDiv.className = 'col-md-3';
//     pdfDiv.innerHTML = `<div>${pdfIcon} ${fileLink}</div>`;
//     pdfDiv.dataset.filepath = file.name; // Save the file path in the div

//     pdfContentsDiv.appendChild(pdfDiv);
// }

function openPDF(url) {
    window.open(url, '_blank');
}
  
function updateOverallPageCountAndPrice() {
    let overallPages = 0;
    const pageElements = ['file-pages-1', 'file-pages-2', 'file-pages-3', 'file-pages-4', 'file-pages-5', 'file-pages-6', 'file-pages-7', 'file-pages-8', 'file-pages-9', 'file-pages-10'];
    
    pageElements.forEach(pageId => {
        const pages = parseInt(document.getElementById(pageId).innerText) || 0;
        overallPages += pages;
    });

    // document.getElementById('paper-copy-pages').value = overallPages;
    document.getElementById('total-pages').value = overallPages; 
    updateOverallPrice(overallPages);
}





  
function updateOverallPrice(overallPages) {
    const pricePerPage = '';
    const totalVal = overallPages * pricePerPage;

    document.getElementById('totalval').value = totalVal.toFixed(2);
    document.getElementById('total-amount').value = totalVal.toFixed(2); 
    document.getElementById('balance').value = totalVal.toFixed(2); 
}

  













function sendInvoiceReceipt() {
    updateInvoiceTable();

    const emailElement = document.getElementById('email');
    if (!emailElement) {
        alert('Email element not found.');
        return;
    }

    const emailId = emailElement.value.trim();
    if (!emailId) {
        alert('Email ID is empty.');
        return;
    }

    const htmlContent = document.getElementById('printbodycontent').innerHTML;
    if (!htmlContent) {
        alert('HTML content is empty.');
        return;
    }


    
    const formData = new FormData();
    formData.append('emailid', emailId);
    formData.append('htmlcontent', htmlContent);
    formData.append('total-pages', document.getElementById('total-pages').value);
    formData.append('total-amount', document.getElementById('total-amount').value);
    formData.append('balance', document.getElementById('balance').value);
    

    fetch('/sendinvoicerec/', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.text())
    .then(data => {
        alert(data);
    })
    .catch(error => {
        console.error('Error:', error);
    });
}


  


function generateInvoice() {
    try {
        // Fetch the calculation details dynamically
        const state = document.getElementById('state').value;
        const category = document.getElementById('category').value;
        const totalPages = document.getElementById('total-pages').value;

        if (!state || !category) {
            alert('Please select both state and category.');
            return;
        }

        // Collect optional fees added by the user from the frontend
        let optionalFees = [];
        document.querySelectorAll('.fee-div').forEach(feeDiv => {
            const feeType = feeDiv.querySelector('select').value;
            const feeValue = feeDiv.querySelector('input').value;

            // Only include fees that have a valid value
            if (feeValue && !isNaN(parseFloat(feeValue))) {
                optionalFees.push({
                    type: feeType,
                    value: parseFloat(feeValue)
                });
            }
        });

        // Get hours value if category is Deposition
        let hours = null;
        if (category === 'Deposition') {
            hours = parseInt(document.getElementById('hours').value, 10);
            
        }

        // Fetch the dynamic calculation details based on state and category
        fetch(`/calculate_total_amount/${state}/${category}/${totalPages}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify({ optional_fees: optionalFees, hours: hours }) // Send the frontend values along with the request
        })
        .then(response => response.json())
        .then(data => {
            if (!data || !data.calculation_details || data.calculation_details.length === 0) {
                alert('Failed to fetch calculation details. Please try again.');
                return;
            }

            // Combine backend calculation details with optional frontend fees
            const combinedDetails = [...data.calculation_details, ...optionalFees];

            // Now update the invoice table dynamically with both backend and frontend values
            updateInvoiceTable(combinedDetails);

            // Fetch and insert the optional notes in the "NOTE" section
            const optionalNotes = document.getElementById('optional-notes').value;
            if (optionalNotes) {
                document.getElementById('note-section').innerHTML = `${optionalNotes}`;
            }

            // Proceed with generating the invoice
            const htmlContent = document.getElementById('printbodycontent').innerHTML;
            const totalPagesElement = document.getElementById('total-pages');
            const totalAmountElement = document.getElementById('total-amount');
            const balanceElement = document.getElementById('balance');
            const requestIdElement = document.getElementById('request-id');

            // Check for missing HTML content or elements
            if (!htmlContent) {
                alert('HTML content is empty.');
                return;
            }

            if (!totalPagesElement || !totalAmountElement || !balanceElement || !requestIdElement) {
                alert('One or more elements required for generating the invoice are missing.');
                return;
            }

            // Prepare formData with all required values
            const formData = new FormData();
            formData.append('htmlcontent', htmlContent);
            formData.append('total-pages', totalPagesElement.value);
            formData.append('total-amount', totalAmountElement.value);
            formData.append('balance', balanceElement.value);
            formData.append('request_id', requestIdElement.value);

            saveDates();

            // Send the data via a POST request to generate the PDF
            fetch('/generatepdf/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.pdfpath) {
                    generatedPdfPath = data.pdfpath;
                    alert('Invoice PDF generated successfully.');
                } else {
                    alert('Failed to generate PDF.');
                }
            })
            .catch(error => {
                console.error('Error in fetching PDF:', error);
                alert('An error occurred while generating the PDF.');
            });
        })
        .catch(error => {
            console.error('Error fetching calculation details:', error);
            alert('An error occurred while fetching calculation details.');
        });
    } catch (error) {
        console.error('Error in generateInvoice:', error);
    }
}




function saveDates() {
    // Get values from the date inputs
    const request_Id = document.getElementById('request_id').textContent.split(': ')[1]; // Extract the actual request ID value    const file1FromDate = document.getElementById('file1_from_date').value;
    const file1FromDate = document.getElementById('file1_from_date').value;
    const file1ToDate = document.getElementById('file1_to_date').value;
    const file2FromDate = document.getElementById('file2_from_date').value;
    const file2ToDate = document.getElementById('file2_to_date').value;
    const file3FromDate = document.getElementById('file3_from_date').value;
    const file3ToDate = document.getElementById('file3_to_date').value;
    const file4FromDate = document.getElementById('file4_from_date').value;
    const file4ToDate = document.getElementById('file4_to_date').value;
    const file5FromDate = document.getElementById('file5_from_date').value;
    const file5ToDate = document.getElementById('file5_to_date').value;
    const file6FromDate = document.getElementById('file6_from_date').value;
    const file6ToDate = document.getElementById('file6_to_date').value;
    const file7FromDate = document.getElementById('file7_from_date').value;
    const file7ToDate = document.getElementById('file7_to_date').value;
    const file8FromDate = document.getElementById('file8_from_date').value;
    const file8ToDate = document.getElementById('file8_to_date').value;
    const file9FromDate = document.getElementById('file9_from_date').value;
    const file9ToDate = document.getElementById('file9_to_date').value;
    const file10FromDate = document.getElementById('file10_from_date').value;
    const file10ToDate = document.getElementById('file10_to_date').value;
    // Repeat for each file date

    // Send the data to the backend using AJAX (you can also use form submission)
    fetch('/save_dates/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            'request_id' : request_Id,
            'file1_from_date': file1FromDate,
            'file1_to_date': file1ToDate,
            'file2_from_date': file2FromDate,
            'file2_to_date': file2ToDate,
            'file3_from_date': file3FromDate,
            'file3_to_date': file3ToDate,
            'file4_from_date': file4FromDate,
            'file4_to_date': file4ToDate,
            'file5_from_date': file5FromDate,
            'file5_to_date': file5ToDate,
            'file6_from_date': file6FromDate,
            'file6_to_date': file6ToDate,
            'file7_from_date': file7FromDate,
            'file7_to_date': file7ToDate,
            'file8_from_date': file8FromDate,
            'file8_to_date': file8ToDate,
            'file9_from_date': file9FromDate,
            'file9_to_date': file9ToDate,
            'file10_from_date': file10FromDate,
            'file10_to_date': file10ToDate,
            // Add the rest of the fields here
        })
    }).then(response => {
        return response.json();
    }).then(data => {
        console.log('Dates saved successfully:', data);
    }).catch(error => {
        console.error('Error:', error);
    });
}





function updateTotalAmount() {
    const totalVal = document.getElementById('totalval').value;
    document.getElementById('paymenttotalamount').value = totalVal;
}
  
function fetchLatestInvoicePath(callback) {
    const requestId = document.getElementById('request-id').value;
    fetch(`/get_latest_invoice/${requestId}/`, {
        method: 'GET',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.pdfpath) {
            generatedPdfPath = data.pdfpath;
            callback();
        } else {
            alert('No invoice found. Please generate the invoice first.');
        }
    })
    .catch(error => {
        console.error('Error fetching the latest invoice:', error);
        alert('Error fetching the latest invoice. Please try again.');
    });
}

function viewInvoice() {
    if (!generatedPdfPath) {
        fetchLatestInvoicePath(() => {
            window.open(`/viewpdf/?pdfpath=${encodeURIComponent(generatedPdfPath)}`, '_blank');
        });
    } else {
        window.open(`/viewpdf/?pdfpath=${encodeURIComponent(generatedPdfPath)}`, '_blank');
    }
}

function printInvoice() {
    if (!generatedPdfPath) {
        fetchLatestInvoicePath(() => {
            const printWindow = window.open(`/viewpdf/?pdfpath=${encodeURIComponent(generatedPdfPath)}`, '_blank');
            printWindow.onload = function() {
                printWindow.print();
            };
        });
    } else {
        const printWindow = window.open(`/viewpdf/?pdfpath=${encodeURIComponent(generatedPdfPath)}`, '_blank');
        printWindow.onload = function() {
            printWindow.print();
        };
    }
}
  
function sendDocuments() {
    const emailId = document.getElementById('toaddress').value.trim();
    const cc = document.getElementById('cc').value.trim();
    const bcc = document.getElementById('bcc').value.trim();
    const subject = document.getElementById('tosubject').value.trim();
    const messageContent = document.getElementById('tomsgcontent').value.trim();
    const htmlContent = document.getElementById('printbodycontent').innerHTML;

    //const patientNo = document.getElementById('patient_no').value.trim();
    //const notes = document.getElementById('notes').value.trim();

    if (!emailId) {
        alert('Email ID is empty.');
        return;
    }

    const formData = new FormData();
    formData.append('emailid', emailId);
    formData.append('cc', cc);
    formData.append('bcc', bcc);
    formData.append('sub', subject);
    formData.append('msg', messageContent);
    formData.append('htmlcontent', htmlContent);

    //formData.append('patient_no', patientNo);
    //formData.append('notes', notes);

    const requestId = document.getElementById('request-id').value;
    formData.append('request_id', requestId);

    newSessionFiles.forEach(fileUrl => {
        formData.append('filepaths[]', fileUrl);  // Append the full file path
    });

    if (generatedPdfPath) {
        formData.append('pdfpath', generatedPdfPath);  // Include the invoice PDF path
    }

    fetch('/senddocumentmail/', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.text())
    .then(data => {
        alert(data);
        newSessionFiles = []; // Clear the array after sending
    })
    .catch(error => {
        console.error('Error:', error);
    });
}



document.getElementById('save-patient-data').addEventListener('click', function(event) {
    event.preventDefault();

    // Collect values from form fields
    const patientNo = document.getElementById('patient_no').value;
    const notes = document.getElementById('notes').value;
    const company = document.getElementById('company').value;
    const address1 = document.getElementById('address1').value;
    const address2 = document.getElementById('address2').value;
    const city = document.getElementById('city').value;
    const zipCode = document.getElementById('zip_code').value;
    const email = document.getElementById('email').value;
    const requestId = "{{data.request_id}}";  // Assuming request_id is available in the context

    // Simple validation
    // if (patientNo.trim() === "" || notes.trim() === "" || company.trim() === "" || address1.trim() === "" || city.trim() === "" || zipCode.trim() === "" || email.trim() === "") {
    //     alert("Please fill in all the required fields.");
    //     return;
    // }

    // Send the collected data to the backend
    fetch('/save_patient_data/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            // 'X-CSRFToken': '{{ csrf_token }}' // Uncomment if CSRF protection is enabled
        },
        body: JSON.stringify({
            patient_no: patientNo,
            notes: notes,
            company: company,
            address1: address1,
            address2: address2,
            city: city,
            zip_code: zipCode,
            email: email,
            request_id: requestId
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("Data saved successfully.");
            location.reload()
        } else {
            alert("Failed to save data.");
        }
    })
    .catch(error => console.error('Error:', error));
});




document.addEventListener('DOMContentLoaded', function () {


    document.getElementById('state').addEventListener('change', updateTotalPagesAndAmount);
    document.getElementById('category').addEventListener('change', updateTotalPagesAndAmount);

    fetchExistingFiles();


});


const feeInput = document.querySelector('.fee_input').querySelector('input');

// Add event listeners for input, keyup, and keydown
feeInput.addEventListener('input', updateTotalPagesAndAmount);
feeInput.addEventListener('keyup', updateTotalPagesAndAmount);
feeInput.addEventListener('keydown', updateTotalPagesAndAmount)
document.querySelector('.fee_input').querySelector('select').addEventListener('change', updateTotalPagesAndAmount);

document.getElementById('addFee').addEventListener('click', function() {
    var feeContainer = document.querySelector('.fee-container');
    
    var newDiv = document.createElement('div');
    newDiv.classList.add('fee-div');
    
    newDiv.innerHTML = `
        <select style="width: 40%; height: 35px; border: #ccc solid .5px; border-radius: 5px; color: #555;">
            <option value="Retrieval Fee">Retrieval Fee</option>
            <option value="Postage Fee">Postage Fee</option>
            <option value="Labor Fee">Labor Fee</option>
            <option value="Cert Fee">Cert Fee</option>
            <option value="Handling Fee">Handling Fee</option>
            <option value="Search Fee">Search Fee</option>
            <option value="Initial Fee">Initial Fee</option>
            <option value="Clerical Fee">Clerical Fee</option>
            <option value="Affidavit Fee">Affidavit Fee</option>
            <option value="Notary Fee">Notary Fee</option>
        </select>
        <input type="text" style="width: 40%; height: 35px; border: #ccc solid .5px; border-radius: 5px; color: #555;">
        <i class="fa fa-times removeFee" style="color: red; cursor: pointer;"></i>
    `;

    feeContainer.appendChild(newDiv);

    // Attach the click event for the newly created remove button
    newDiv.querySelector('.removeFee').addEventListener('click', function() {
        newDiv.remove();
        updateTotalPagesAndAmount();  // Recalculate when a fee is removed
    });

    // Attach event listeners to recalculate the total when fee values change
    newDiv.querySelector('input').addEventListener('input', updateTotalPagesAndAmount);
    newDiv.querySelector('input').addEventListener('keyup', updateTotalPagesAndAmount);
    newDiv.querySelector('input').addEventListener('keydown', updateTotalPagesAndAmount)
    newDiv.querySelector('select').addEventListener('change', updateTotalPagesAndAmount);
});

// document.getElementById('saveFees').addEventListener('click', function() {
//     let optionalFees = [];
//     document.querySelectorAll('.fee-div').forEach(feeDiv => {
//         const feeType = feeDiv.querySelector('select').value;
//         const feeValue = feeDiv.querySelector('input').value;

//         if (feeValue && !isNaN(parseFloat(feeValue))) {
//             optionalFees.push({
//                 type: feeType,
//                 value: parseFloat(feeValue)
//             });
//         }
//     });

//     const state = document.getElementById('state').value;
//     const category = document.getElementById('category').value;
//     const totalPages = document.getElementById('total-pages').value;

//     if (state && category) {
//         fetch(`/calculate_total_amount/${state}/${category}/${totalPages}/`, {
//             method: 'POST',
//             headers: {
//                 'Content-Type': 'application/json',
//                 'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
//             },
//             body: JSON.stringify({ optional_fees: optionalFees })
//         })
//         .then(response => response.json())
//         .then(data => {
//             console.log("Total Amount calculated by backend:", data.total_amount);
//             document.getElementById('totalval').value = data.total_amount.toFixed(2);
//             document.getElementById('total-amount').value = data.total_amount.toFixed(2);
//             displayCalculationDetails(data.calculation_details, data.total_amount);
//         })
//         .catch(error => {
//             console.error('Error:', error);
//         });
//     }
// });

document.getElementById('state').addEventListener('change', function() {
    removedFees = []; // Reset removed fees when the state changes
    fetchInitialCalculation();
    updateTotalPagesAndAmount();
    
});

document.getElementById('category').addEventListener('change', function() {
    removedFees = []; // Reset removed fees when the category changes
    fetchInitialCalculation();
    updateTotalPagesAndAmount();
    
});


function fetchInitialCalculation() {
    const state = document.getElementById('state').value;
    const category = document.getElementById('category').value;
    const totalPages = document.getElementById('total-pages').value;

    if (state && category) {
        fetch(`/calculate_total_amount/${state}/${category}/${totalPages}/`, {
            method: 'GET',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            updateTotalAmountAndDetails(data);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
}


// Event listener to detect manual edits in the 'Total Pages' input field
document.getElementById('paper-copy-pages').addEventListener('input', function() {
    manuallyEditedPages = true;  // Mark the manual edit flag as true
    updateTotalPagesAndAmount();  // Call the onchange function to recalculate based on manual input
});







// Add event listener to detect when the user changes the category
document.getElementById('category').addEventListener('change', function() {
    const hoursGroup = document.getElementById('hours-group');
    const category = this.value;

    if (category === 'Deposition') {
        hoursGroup.style.display = 'block';  // Show the hours input
    } else {
        hoursGroup.style.display = 'none';  // Hide the hours input for other categories
    }
});

// Add event listener to detect when the user clicks out or presses tab on hours input
document.getElementById('hours').addEventListener('blur', function() {
    const category = document.getElementById('category').value;  // Get the selected category
    const hours = this.value;

    // Validate and process hours only if the category is "Deposition"
    if (category === 'Deposition' && hours && hours >= 1) {
        updateTotalPagesAndAmount();  // Trigger the calculation when the user leaves the hours input
    }
});





document.getElementById('state').addEventListener('change', checkStateAndCategory);
document.getElementById('category').addEventListener('change', checkStateAndCategory);
document.getElementById('delivery-method').addEventListener('change', function() {
    updateTotalPagesAndAmount(); 
});

// Function to check state and category
function checkStateAndCategory() {
    const state = document.getElementById('state').value;
    const category = document.getElementById('category').value;
    const deliveryMethodGroup = document.getElementById('delivery-method-group');

    // Only show the additional select and input if state is "South Carolina" and category is "general"
    if (state === 'South Carolina' && category === 'general') {
        deliveryMethodGroup.style.display = 'block';
    } else {
        deliveryMethodGroup.style.display = 'none';  // Hide the section if the conditions are not met
    }
}






let manuallyEditedPages = false;  // Flag to detect manual edits

// Function to update total pages and amount when input or table changes
function updateTotalPagesAndAmount() {
    let totalPages = 0;

    // Loop through all rows with page values and add them up
    const fileRows = document.querySelectorAll('[id^="file-pages-"]');  // Select all rows that have page counts
    fileRows.forEach(row => {
        const pages = parseInt(row.innerText, 10);
        
        // If the page count is empty or not a number, treat it as zero
        if (!isNaN(pages) && pages > 0) {
            totalPages += pages;
        }
    });

    // If the pages were manually edited, use the manually entered value
    if (manuallyEditedPages) {
        const manuallyEnteredPages = parseInt(document.getElementById('paper-copy-pages').value, 10) || 0;
        totalPages = manuallyEnteredPages;  // Override with manually entered pages
    } else {
        // Update the 'paper-copy-pages' input and hidden 'total-pages' field with the calculated total
        document.getElementById('total-pages').value = totalPages;
        document.getElementById('paper-copy-pages').value = totalPages;
    }

    // Fetch the state and category
    const state = document.getElementById('state').value;
    const category = document.getElementById('category').value;



    // Get hours value if category is Deposition
    let hours = null;
    if (category === 'Deposition') {
        hours = parseInt(document.getElementById('hours').value, 10);
        // if (isNaN(hours) || hours <= 0) {
        //     alert('Please enter a valid number of hours for Deposition.');
        //     return;
        // }
    }


    const deliveryMethod = document.getElementById('delivery-method').value;

    // Collect optional fees added by the user
    let optionalFees = [];
    document.querySelectorAll('.fee-div').forEach(feeDiv => {
        const feeType = feeDiv.querySelector('select').value;
        const feeValue = feeDiv.querySelector('input').value;

        // Only include fees that have a valid value
        if (feeValue && !isNaN(parseFloat(feeValue))) {
            optionalFees.push({
                type: feeType,
                value: parseFloat(feeValue)
            });
        }
    });

    // If both state and category are selected, make the API call
    if (state && category) {
        fetch(`/calculate_total_amount/${state}/${category}/${totalPages}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: JSON.stringify({ optional_fees: optionalFees, hours: hours, delivery_method: deliveryMethod }) 
        })
        .then(response => response.json())
        .then(data => {
            // Update the total amount and other fields based on backend calculation
            document.getElementById('totalval').value = data.total_amount.toFixed(2);
            document.getElementById('total-paper-charge').value = data.total_paper_charge.toFixed(2);
            document.getElementById('total-additional-fees').value = data.total_additional_fees.toFixed(2);

            // Display calculation details in the container
            displayCalculationDetails(data.calculation_details, data.total_amount);

            // Update the invoice with the calculated details
            updateInvoiceTable(data.calculation_details);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
}

// Function to add pages from newly uploaded files to the total
function addNewFilePages(newFilePages) {
    let currentTotalPages = parseInt(document.getElementById('paper-copy-pages').value, 10) || 0;

    // Add new file pages to the current total
    currentTotalPages += newFilePages;

    // Update the total pages field and hidden 'total-pages' field
    document.getElementById('paper-copy-pages').value = currentTotalPages;
    document.getElementById('total-pages').value = currentTotalPages;

    // Reset the manual edit flag since this is an automatic update
    manuallyEditedPages = false;

    // Trigger the calculation function to recalculate based on new total
    updateTotalPagesAndAmount();
}

// Event listener for 'paper-copy-pages' input change to send the updated value to the backend
document.getElementById('paper-copy-pages').addEventListener('change', function () {
    manuallyEditedPages = true;  // Mark as manually edited

    const manuallyEnteredPages = parseInt(this.value, 10) || 0;  // Get the manually entered pages
    const totalPages = manuallyEnteredPages;  // Use only the manually entered pages
    

    // Send the updated total pages to the backend
    // sendPagesToBackend(totalPages);
});

// Function to send total pages to the backend
// function sendPagesToBackend(totalPages) {
//     const state = document.getElementById('state').value;
//     const category = document.getElementById('category').value;

//     if (state && category) {
//         // Send the updated totalPages to the backend
//         fetch(`/save_total_pages/`, {
//             method: 'POST',
//             headers: {
//                 'Content-Type': 'application/json',
//                 'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
//             },
//             body: JSON.stringify({
//                 'total_pages': totalPages,
//                 'state': state,
//                 'category': category
//             })
//         })
//         .then(response => response.json())
//         .then(data => {
//             console.log('Successfully sent pages to backend:', data);
//         })
//         .catch(error => {
//             console.error('Error sending pages to backend:', error);
//         });
//     }
// }

// Event listener for detecting changes in the state and category dropdowns
document.getElementById('state').addEventListener('change', updateTotalPagesAndAmount);
document.getElementById('category').addEventListener('change', updateTotalPagesAndAmount);





let removedFees = []; // Store the removed fees

function displayCalculationDetails(details, total) {
    const detailsContainer = document.getElementById('calculation-details');
    detailsContainer.innerHTML = '';  // Clear previous content

    let currentTotal = 0;  // Initialize current total
    let totalPaperCharge = 0;  // Track the total "Charge for Page(s)" or any "Charge for"

    // Loop through all fee-div inputs and reset any removed fee inputs
    document.querySelectorAll('.fee-div').forEach(feeDiv => {
        const feeType = feeDiv.querySelector('select').value;

        // If the fee is in the removedFees list, reset the input value
        if (removedFees.includes(feeType)) {
            feeDiv.querySelector('input').value = ''; // Reset the input
        }
    });

    // Filter out the removed fees before displaying
    const filteredDetails = details.filter(detail => !removedFees.includes(detail.label));

    filteredDetails.forEach((detail, index) => {
        // Track all labels starting with "Charge for"
        if (detail.label.startsWith("Charge for")) {
            totalPaperCharge += detail.value;
        }

        // Add the current charge to the total
        currentTotal += detail.value;

        const detailRow = document.createElement('div');
        detailRow.style.display = 'grid';
        detailRow.style.gridTemplateColumns = '1fr 1fr auto';
        detailRow.style.alignItems = 'center';
        detailRow.style.marginBottom = '8px';

        // Label (Charge Name)
        const labelElement = document.createElement('span');
        labelElement.style.color = '#555';
        labelElement.textContent = detail.label;

        // Value (Charge Value)
        const valueElement = document.createElement('span');
        valueElement.style.color = '#333';
        valueElement.style.fontWeight = 'bold';
        valueElement.textContent = `$${detail.value.toFixed(2)}`;

        // Remove Icon
        const removeIcon = document.createElement('i');
        removeIcon.className = 'fa fa-times';
        removeIcon.style.color = 'red';
        removeIcon.style.cursor = 'pointer';
        removeIcon.style.justifySelf = 'end';  // Align icon to the right
        removeIcon.addEventListener('click', function() {
            // Remove the charge from the calculation container and invoice
            currentTotal -= detail.value;
            removedFees.push(detail.label); // Add the removed fee to the list

            // Reset the input value for the removed fee
            document.querySelectorAll('.fee-div').forEach(feeDiv => {
                const feeType = feeDiv.querySelector('select').value;
                if (feeType === detail.label) {
                    feeDiv.querySelector('input').value = ''; // Reset input
                }
            });

            // Update both calculation details and invoice
            displayCalculationDetails(details, currentTotal);
            
            updateInvoiceTable(filteredDetails);  // Pass updated details to the invoice

            // Update the total value
            document.getElementById('totalval').value = currentTotal.toFixed(2);
        });

        detailRow.appendChild(labelElement);
        detailRow.appendChild(valueElement);
        detailRow.appendChild(removeIcon);

        detailsContainer.appendChild(detailRow);
    });

    // Add horizontal line above the total
    const hrElement = document.createElement('hr');
    hrElement.style.marginTop = '10px';
    hrElement.style.borderColor = '#000';
    detailsContainer.appendChild(hrElement);

    // Total Row
    const totalElement = document.createElement('div');
    totalElement.style.display = 'grid';
    totalElement.style.gridTemplateColumns = '1fr auto auto';  // Two columns: 1st for label, 2nd for value, 3rd empty
    totalElement.style.marginTop = '10px';
    totalElement.style.fontSize = '1rem';
    totalElement.style.fontWeight = 'bold';
    totalElement.style.color = '#333';

    const totalLabel = document.createElement('span');
    totalLabel.textContent = 'Total:';
    totalLabel.style.justifySelf = 'start';

    const totalValue = document.createElement('span');
    totalValue.style.justifySelf = 'end';
    totalValue.textContent = `$${currentTotal.toFixed(2)}`;

    const emptyElement = document.createElement('span');  // Empty third column

    totalElement.appendChild(totalLabel);
    totalElement.appendChild(totalValue);
    totalElement.appendChild(emptyElement);  // Add the empty column

    detailsContainer.appendChild(totalElement);

    // Update the hidden field with the new total "Charge for Page(s)" or any "Charge for" value
    document.getElementById('total-paper-charge').value = totalPaperCharge.toFixed(2);
    
    // Update the total value hidden field
    document.getElementById('totalval').value = currentTotal.toFixed(2);
}

// Event listener to handle when a removed fee is re-entered
document.querySelectorAll('.fee-div').forEach(feeDiv => {
    const feeInput = feeDiv.querySelector('input');
    feeInput.addEventListener('input', function () {
        const feeType = feeDiv.querySelector('select').value;
        const feeValue = parseFloat(feeInput.value);

        // If the fee was removed and the user re-enters a value, re-include it in the calculation
        if (removedFees.includes(feeType) && feeValue > 0) {
            removedFees = removedFees.filter(fee => fee !== feeType); // Remove from removedFees list
            
            // Update the currentTotal and re-display the details
            currentTotal += feeValue; // Add the re-entered value to the total
            updateTotalPagesAndAmount();  // Recalculate the total amount with the re-added fee
            displayCalculationDetails(details, currentTotal); // Re-display the calculation with updated total
        }
    });
});



function updateInvoiceTable(details) {
    const items = [
        { name: 'Misc 1', pagesId: 'file-pages-1', pathId: 'file-name-1', fromDateId: 'file1_from_date', toDateId: 'file1_to_date' },
        { name: 'Misc 2', pagesId: 'file-pages-2', pathId: 'file-name-2', fromDateId: 'file2_from_date', toDateId: 'file2_to_date' },
        { name: 'Misc 3', pagesId: 'file-pages-3', pathId: 'file-name-3', fromDateId: 'file3_from_date', toDateId: 'file3_to_date' },
        { name: 'Misc 4', pagesId: 'file-pages-4', pathId: 'file-name-4', fromDateId: 'file4_from_date', toDateId: 'file4_to_date' },
        { name: 'Misc 5', pagesId: 'file-pages-5', pathId: 'file-name-5', fromDateId: 'file5_from_date', toDateId: 'file5_to_date' },
        { name: 'Misc 6', pagesId: 'file-pages-6', pathId: 'file-name-6', fromDateId: 'file6_from_date', toDateId: 'file6_to_date' },
        { name: 'Misc 7', pagesId: 'file-pages-7', pathId: 'file-name-7', fromDateId: 'file7_from_date', toDateId: 'file7_to_date' },
        { name: 'Misc 8', pagesId: 'file-pages-8', pathId: 'file-name-8', fromDateId: 'file8_from_date', toDateId: 'file8_to_date' },
        { name: 'Misc 9', pagesId: 'file-pages-9', pathId: 'file-name-9', fromDateId: 'file9_from_date', toDateId: 'file9_to_date' },
        { name: 'Misc 10', pagesId: 'file-pages-10', pathId: 'file-name-10', fromDateId: 'file10_from_date', toDateId: 'file10_to_date' }
    ];

    let tableBody = document.getElementById('invoice-tbody');
    tableBody.innerHTML = ''; // Clear existing rows

    // Get total pages and total amount
    let totalPages = parseInt(document.getElementById('paper-copy-pages').value) || 0;
    let totalAmount = parseFloat(document.getElementById('totalval').value) || 0;

    // Add item rows for files in the table
    let hasFiles = false;
    items.forEach((item, index) => {
        const pathElement = document.getElementById(item.pathId);
        const fromDateElement = document.getElementById(item.fromDateId);
        const toDateElement = document.getElementById(item.toDateId);

        if (pathElement && pathElement.innerHTML.trim() !== '') {
            hasFiles = true;  // Mark that we have files to show
            const fileName = pathElement.innerText;
            const fromDate = fromDateElement ? fromDateElement.value : 'N/A';  // Default to 'N/A' if not provided
            const toDate = toDateElement ? toDateElement.value : 'N/A';        // Default to 'N/A' if not provided

            let row = `
                <tr>
                    <td>${index + 1}</td>
                    <td>PDF</td>
                    <td>${fileName}</td>
                    <td>${fromDate}</td>
                    <td>${toDate}</td>
                    ${index === 0 ? `<td rowspan="${items.length}" class="text-end">${totalPages}</td>` : ''}
                    ${index === 0 ? `<td rowspan="${items.length}" class="text-end">$${totalAmount.toFixed(2)}</td>` : ''}
                </tr>
            `;
            tableBody.innerHTML += row;
        }
    });

    // If no files were added, show an empty state message in the table
    if (!hasFiles) {
        let emptyRow = `
            <tr>
                <td colspan="7" class="text-center">No files added</td>
            </tr>
        `;
        tableBody.innerHTML += emptyRow;
    }

    const invSummary = document.getElementById('inv-summary');
    invSummary.innerHTML = '';  // Clear existing content

    // Add dynamic label-value pairs for additional fees in the invSummary section as <p> tags
    details.forEach(detail => {
        if (detail && detail.label && detail.value !== undefined) {
            if (!detail.label.startsWith("Charge") && !removedFees.includes(detail.label)) {
                let summaryItem = `
                    <p><strong>${detail.label}:</strong> $${detail.value.toFixed(2)}</p>
                `;
                invSummary.innerHTML += summaryItem;
            }
        }
    });

    // Add total paper charge at the bottom of the invoice (but not in the table)
    let totalPaperCharge = parseFloat(document.getElementById('total-paper-charge').value) || 0;
    let paperChargeItem = `
        <p><strong>Total Paper Charge:</strong> $${totalPaperCharge.toFixed(2)}</p>
    `;
    invSummary.innerHTML += paperChargeItem;

    // Calculate the total value of additional fees
    let feesTotal = details.reduce((acc, curr) => acc + (curr.value || 0), 0);

    // The `totalAmount` already includes fees from the backend, but we need to update the total invoice value
    let finalTotalAmount = parseFloat(document.getElementById('totalval').value) || 0;

    // Update invoice total
    const invTotalElement = document.getElementById('inv-total');
    if (invTotalElement) {
        invTotalElement.innerText = `USD $${finalTotalAmount.toFixed(2)}`;
    }
}







// Example of fetching data from the backend
// fetch(`/calculate_total_amount/${state}/${category}/${totalPages}/`)
//     .then(response => response.json())
//     .then(data => {
//         if (data.error) {
//             console.error('Error:', data.error);
//         } else {
//             displayCalculationDetails(data.calculation_details, data.total_amount);
//         }
//     });
  </script>
  



        
        <!-- Init js -->
     